"use strict";const e=require("../../../common/vendor.js"),o=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../store/modules/app.js"),require("../../../store/modules/device.js"),require("../../../store/modules/order.js"),require("../../../store/modules/user.js"),require("../../../utils/uniAsync.js"),require("../../../utils/wx.log.js");const r=require("../../../utils/config/index.js");require("../../../hooks/uni-hooks/dialog.js");const s=require("../../../hooks/uni-hooks/emitKey.js");require("../../../hooks/uni-hooks/request.js");const n=require("../../../hooks/uni-hooks/unite.js");require("../../../hooks/uni-hooks/wechat.js");const t=require("../../../hooks/usePagination.js");require("../../../hooks/useCountryCode.js");const i=require("../../../api/order.js"),a=require("../../../hooks/business/use-order-btn-opt.js");if(require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../utils/config/env.js"),require("../../../const/platform.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../theme/hooks/useTheme.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),require("../../../api/device.js"),require("../../../api/user.js"),require("../../../const/order.js"),require("../../../hooks/uni-hooks/router.js"),require("../../../hooks/usePromise.js"),require("../../../api/delivery.js"),require("../../../shared/device.js"),require("../../../const/common.js"),require("../../../utils/appEnterVerif.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),require("../../../hooks/useWechatSI.js"),require("../../../shared/order.js"),require("../../../shared/pay.js"),require("../../../utils/is.js"),require("../../../hooks/use-keyval/index.js"),require("../../../const/coupon.js"),!Array){(e.resolveComponent("mot-empty")+e.resolveComponent("mot-modal"))()}Math||(l+h+(()=>"../../../uni_modules/mot-empty/components/mot-empty/mot-empty.js")+u+d+c+(()=>"../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js"))();const u=()=>"../../../components/business/slide-popup/index.js",d=()=>"../../../components/business/recharge-popup/index.js",c=()=>"../../../components/special-model/order-open-model/index.js",l=()=>"./components/order.js",h=()=>"./components/recharge.js",m=e.defineComponent({__name:"index",setup(u){const d=e.ref(),{query:c,useSkip:l}=t.usePagination(),{useBtnOperateState:h,cbSlideConfirm:m,cbOrderItem:p,cbRenew:g}=a.useBtnOperate((()=>{x(f.tabIndex),j(f.tabIndex)})),f=e.reactive({from:"me",recordList:[{data:[],loadingText:o.t("sub-pages.me.order.index.3")},{data:[],loadingText:o.t("sub-pages.me.order.index.3")}],tabIndex:0,tabBars:[{name:o.t("sub-pages.me.order.index.5"),id:"order"},{name:o.t("sub-pages.me.order.index.6"),id:"recharge"}],cacheTab:[],scrollInto:"",showTips:!1,navigateFlag:!1,pulling:!1});e.onLoad((e=>{const{from:r}=e||{};"withdraw"===r&&(f.tabIndex=1),j(f.tabIndex),n.unite.setNavigationBarTitle(o.t("pages.json.37"))})),e.onShow((()=>{e.index.$once(s.EMIT_REFRESH_ORDER,(()=>{x(f.tabIndex),j(f.tabIndex)}))}));const j=async e=>{if(c.loading||c.lastPage)return;c.loading=!0;const r={limit:c.limit,skip:l()},s=f.recordList[e],n=0===e?i.lockerOrderApi:i.paymentApi,t=await n.find(r).finally((()=>c.loading=!1));t.length===c.limit?c.page+=1:(c.lastPage=!0,s.loadingText=o.t("sub-pages.me.order.index.8")),s.data=s.data.concat(t)},q=e=>{const o=e.target.dataset.current||e.currentTarget.dataset.current;console.log("onTabTap:",o),k(o)},b=e=>{const o=e.target.current||e.detail.current;console.log("onTabChange:",o),k(o)},k=e=>{if(console.log("switchTab:",e),f.tabIndex!==e){if(console.log("switchTab.after:",e),0===f.recordList[e].data.length&&(x(e),j(e)),f.recordList[f.tabIndex].data.length>100){f.cacheTab.indexOf(f.tabIndex)<0&&f.cacheTab.push(f.tabIndex)}if(f.tabIndex=e,f.scrollInto=f.tabBars[e].id,f.cacheTab.length>3){const e=f.cacheTab[0];x(e),f.cacheTab.splice(0,1)}}},x=e=>{c.page=1,c.lastPage=!1,f.recordList[e].data.length=0},{recordList:T,tabIndex:I,tabBars:v,scrollInto:y}=e.toRefs(f),w=e.ref();return(s,n)=>{var t,i;return e.e({a:"overflow:"+(e.unref(h).showRecharge?"hidden":"visible"),b:e.f(e.unref(v),((o,r,s)=>({a:e.t(o.name),b:e.n(e.unref(I)==r?"uni-tab-item-title-active":""),c:o.id,d:o.id,e:r,f:e.o(q,o.id)}))),c:e.unref(y),d:(null==(t=e.unref(T)[e.unref(I)])?void 0:t.data.length)>0},(null==(i=e.unref(T)[e.unref(I)])?void 0:i.data.length)>0?{e:e.f(e.unref(T),((o,r,s)=>e.e({a:e.f(o.data,((o,r,n)=>e.e(0===e.unref(I)?{a:e.o(e.unref(p),o.id),b:"a9a1147e-0-"+s+"-"+n,c:e.p({order:o})}:{d:"a9a1147e-1-"+s+"-"+n,e:e.p({item:o})},{f:o.id}))),b:e.unref(c).loading||o.data.length>0},e.unref(c).loading||o.data.length>0?{c:e.t(o.loadingText)}:{},{d:e.o((e=>{setTimeout((()=>{j(f.tabIndex)}),500)}),r),e:r}))),f:0===e.unref(I),g:e.unref(I),h:e.o(b)}:{i:e.p({description:e.unref(o.t)("common.no_data"),image:e.unref(r.config).fileBaseUrl+"/order_empty.png"})},{j:e.o(e.unref(m)),k:e.o((o=>e.unref(h).showSlid=o)),l:e.p({type:e.unref(h).slidType,modelValue:e.unref(h).showSlid}),m:e.o(e.unref(g)),n:e.o((o=>e.unref(h).showRecharge=o)),o:e.p({order:e.unref(h).order,modelValue:e.unref(h).showRecharge}),p:e.sr(d,"a9a1147e-5",{k:"openRef"}),q:e.sr(w,"a9a1147e-6",{k:"ModalRef"}),r:e.p({id:"ModalRef"})})}}}),p=e._export_sfc(m,[["__scopeId","data-v-a9a1147e"]]);wx.createPage(p);
