"use strict";require("../../../common/vendor.js");const e=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../store/modules/app.js"),require("../../../store/modules/device.js"),require("../../../store/modules/order.js"),require("../../../store/modules/user.js");const o=require("../../../const/order.js");require("../../../utils/uniAsync.js"),require("../../../utils/wx.log.js"),require("../../../utils/config/index.js");const r=require("../../../hooks/uni-hooks/dialog.js");require("../../../hooks/uni-hooks/request.js");const s=require("../../../hooks/uni-hooks/router.js");require("../../../hooks/uni-hooks/wechat.js"),require("../../../hooks/useCountryCode.js");const i=require("../../../api/coupon.js");require("../../../shared/order.js");const u=require("../../../shared/pay.js");exports.useOperation=t=>{const n=(e,o)=>{s.reLaunch(`/sub-pages/me/coupon-result/index?couponPackageId=${e}&payed=${o}`)};return{createCouponOrder:async()=>{const{payed:d,id:a,site:c}=t.value;if(!a)return;if(d&&d>0){const{display_id:i}=await u.topUp({payed:d,site_id:c.id,order_data:{coupon_package_id:a,site_id:c.id}},o.PayOrderTypeEnum.Coupon);try{const{promise:e}=u.transactionPreOrderResult(i),o=await e,{order:r}=o;n(r.id,r.payed)}catch(q){const{code:o=5001,msg:i=e.t("sub-pages.coupon.index.27")}=q||{};r.dialog.alert(`${i}(${o})`).then(s.goHome)}return}const p=await i.couponApi.post({coupon_package_id:a});n(p.id,p.payed)}}};
