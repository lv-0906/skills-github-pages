"use strict";const e=require("../../../common/vendor.js"),o=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../store/modules/app.js"),require("../../../store/modules/device.js"),require("../../../store/modules/order.js"),require("../../../store/modules/user.js");const s=require("../../../const/coupon.js");require("../../../utils/uniAsync.js"),require("../../../utils/wx.log.js");const n=require("../../../utils/config/index.js");require("../../../hooks/uni-hooks/dialog.js"),require("../../../hooks/uni-hooks/request.js");const u=require("../../../hooks/uni-hooks/router.js"),r=require("../../../hooks/uni-hooks/unite.js");require("../../../hooks/uni-hooks/wechat.js");const t=require("../../../hooks/usePagination.js");require("../../../hooks/useCountryCode.js");const i=require("../../../api/coupon.js");if(require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../utils/config/env.js"),require("../../../const/platform.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../theme/hooks/useTheme.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),require("../../../api/device.js"),require("../../../api/order.js"),require("../../../api/user.js"),require("../../../const/order.js"),require("../../../hooks/usePromise.js"),require("../../../api/delivery.js"),require("../../../shared/device.js"),require("../../../const/common.js"),require("../../../utils/appEnterVerif.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),!Array){(e.resolveComponent("mot-sticky")+e.resolveComponent("mot-empty")+e.resolveComponent("mot-button")+e.resolveComponent("mot-modal"))()}Math||(a+(()=>"../../../uni_modules/mot-sticky/components/mot-sticky/mot-sticky.js")+c+(()=>"../../../uni_modules/mot-empty/components/mot-empty/mot-empty.js")+(()=>"../../../uni_modules/mot-button/components/mot-button/mot-button.js")+(()=>"../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js"))();const a=()=>"../../../components/tab-panel/index.js",c=()=>"../../../components/v1/coupon/coupon-list-item.js",m=e.defineComponent({__name:"index",setup(a){const{query:c,useSkip:m}=t.usePagination(),l=e.reactive({currentTab:"available",coupons:[]}),p=[{name:o.t("sub-pages.me.coupon.index.2"),value:"available"},{name:o.t("sub-pages.me.coupon.index.8"),value:"unavailable"}];e.onLoad((()=>{d(),r.unite.setNavigationBarTitle(o.t("components.v1.coupon.coupon-panel.1"))})),e.onReachBottom((()=>{d()}));const d=async(e=!1)=>{if(c.lastPage||c.loading)return;c.loading=!0;const o={limit:20,skip:m()};"available"===l.currentTab?o.status=s.CouponStatusEnum.AVAILABLE:o.status_in=[s.CouponStatusEnum.EXPIRED,s.CouponStatusEnum.DEFUNCT,s.CouponStatusEnum.DISABLE].join();const n=await i.couponApi.find(o).finally((()=>{c.loading=!1}));n.length===c.limit?c.page+=1:c.lastPage=!0,l.coupons=e?n:l.coupons.concat(n)};e.watch((()=>l.currentTab),(e=>{l.currentTab=e,c.page=1,c.lastPage=!1,d(!0)}));const j=()=>{u.navigateTo("/sub-pages/me/exchangecoupon/index")},h=e.ref();return(s,u)=>e.e({a:e.o((o=>e.unref(l).currentTab=o)),b:e.p({list:p,modelValue:e.unref(l).currentTab}),c:e.unref(l).coupons.length>0},e.unref(l).coupons.length>0?e.e({d:e.f(e.unref(l).coupons,((o,s,n)=>({a:"600fd3b0-2-"+n,b:e.p({coupon:o,type:"available"===e.unref(l).currentTab?"list":"useless"}),c:null==o?void 0:o.id}))),e:e.unref(c).lastPage},e.unref(c).lastPage?{f:e.t(e.unref(o.t)("sub-pages.me.coupon.index.5"))}:{}):{g:e.p({description:e.unref(o.t)("sub-pages.me.coupon.index.6"),image:e.unref(n.config).fileBaseUrl+"/order_empty.png"})},{h:e.t(e.unref(o.t)("coupon.exchange_card")),i:e.o(j),j:e.p({shape:"square",isBlock:!0}),k:e.sr(h,"600fd3b0-5",{k:"ModalRef"}),l:e.p({id:"ModalRef"})})}});wx.createPage(m);
