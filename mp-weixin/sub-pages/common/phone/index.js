"use strict";const e=require("../../../common/vendor.js"),o=require("../../../api/coupon.js");require("../../../store/modules/app.js");const s=require("../../../store/modules/device.js");require("../../../store/modules/order.js");const r=require("../../../store/modules/user.js");require("../../../shared/order.js"),require("../../../shared/pay.js");const n=require("../../../shared/user.js"),i=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../utils/uniAsync.js");const u=require("../../../utils/validate.js");require("../../../utils/wx.log.js");const t=require("../../../utils/config/index.js"),a=require("../../../hooks/uni-hooks/dialog.js");require("../../../hooks/uni-hooks/request.js");const h=require("../../../hooks/uni-hooks/unite.js");require("../../../hooks/uni-hooks/wechat.js");const l=require("../../../hooks/usePhoneFormatter.js");if(require("../../../hooks/useCountryCode.js"),require("../../../api/device.js"),require("../../../api/order.js"),require("../../../api/user.js"),require("../../../const/order.js"),require("../../../hooks/uni-hooks/router.js"),require("../../../hooks/usePromise.js"),require("../../../api/delivery.js"),require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../shared/device.js"),require("../../../const/common.js"),require("../../../utils/appEnterVerif.js"),require("../../../hooks/useWechatSI.js"),require("../../../hooks/use-keyval/index.js"),require("../../../const/coupon.js"),require("../../../utils/is.js"),require("../../../const/platform.js"),require("../../../utils/config/env.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../theme/hooks/useTheme.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),!Array){(e.resolveComponent("mot-button")+e.resolveComponent("mot-modal"))()}Math||(d+(()=>"../../../uni_modules/mot-button/components/mot-button/mot-button.js")+(()=>"../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js"))();const d=()=>"../../../components/business/phone-button/index.js",p=e.defineComponent({__name:"index",setup(d){const p=r.useUserStore(),c=s.useDeviceStore(),{phone:m}=l.usePhoneFormatter(p.phone),j=e.reactive({loading:!1});e.onShow((()=>{h.unite.setNavigationBarTitle(i.t("sub-pages.common.phone.index.3"))}));const q=async()=>{var e;if(!u.isInternationalPhone(m.value))return void a.toast(i.t("v1_deposit.toast.phone"));j.loading=!0;const s=u.trim(m.value);p.phone||await v({phone:s,type:"input"}),o.vipApi.queryByPhone({phone:s,vip_type:c.vipType,site_id:null==(e=null==c?void 0:c.site)?void 0:e.id}).then((e=>{console.log("[ data ] >",e),p.setUserInfo({...p.user,phone:s}),f(e)})).catch((e=>{console.log("[ queryByPhone err ] >",e),f()}))},f=e=>{const o=e||{};p.setVipCoupon(o),c.goNextPage(2),j.loading=!1},k=({code:e,type:o})=>{v({code:e,type:o})},v=async e=>{const o=await n.setPhone(e);m.value=u.t344Phone(o),p.setUserInfo({...p.user,phone:m})},g=e.ref();return(o,s)=>{var r,n,u,a;return e.e({a:e.unref(t.config).fileBaseUrl+"/phone_bg.png",b:e.t(e.unref(i.t)("sub-pages.common.phone.index.3")),c:e.t(e.unref(i.t)("sub-pages.common.phone.index.2")),d:e.unref(i.t)("sub-pages.common.phone.index.4"),e:e.unref(m),f:e.o((o=>e.isRef(m)?m.value=o.detail.value:null)),g:!e.unref(p).phone&&(null==(n=null==(r=e.unref(c))?void 0:r.shop)?void 0:n.auto_get_phone_enable)},!e.unref(p).phone&&(null==(a=null==(u=e.unref(c))?void 0:u.shop)?void 0:a.auto_get_phone_enable)?{h:e.o(k)}:{},{i:e.t(e.unref(j).loading?e.unref(i.t)("sub-pages.common.phone.index.5"):e.unref(i.t)("order.locker.btn")),j:e.o(q),k:e.p({shape:"square",isBlock:!0,loading:e.unref(j).loading,disabled:e.unref(j).loading}),l:e.sr(g,"728a0f87-2",{k:"ModalRef"}),m:e.p({id:"ModalRef"})})}}}),c=e._export_sfc(p,[["__scopeId","data-v-728a0f87"]]);wx.createPage(c);
