"use strict";const e=require("../../../common/vendor.js"),o=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../store/modules/app.js"),require("../../../store/modules/device.js"),require("../../../store/modules/order.js");const n=require("../../../store/modules/user.js"),s=require("../../../utils/common.js"),r=require("../../../const/emit.js");require("../../../utils/uniAsync.js");const u=require("../../../utils/validate.js");require("../../../utils/wx.log.js"),require("../../../utils/config/index.js");const i=require("../../../hooks/uni-hooks/dialog.js");require("../../../hooks/uni-hooks/request.js");const t=require("../../../hooks/uni-hooks/router.js"),a=require("../../../hooks/uni-hooks/unite.js"),l=require("../../../hooks/uni-hooks/wechat.js"),c=require("../../../api/device.js"),d=require("../../../api/user.js"),m=require("../../../hooks/useCountryCode.js"),h=require("./hook.js");if(require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../utils/config/env.js"),require("../../../const/platform.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../theme/hooks/useTheme.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),require("../../../api/order.js"),require("../../../const/order.js"),require("../../../hooks/usePromise.js"),require("../../../api/delivery.js"),require("../../../shared/device.js"),require("../../../const/common.js"),require("../../../utils/appEnterVerif.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),!Array){(e.resolveComponent("mot-button")+e.resolveComponent("mot-modal"))()}Math||((()=>"../../../uni_modules/mot-button/components/mot-button/mot-button.js")+g+(()=>"../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js"))();const g=()=>"../../../components/business/change-language-popup/index.js",p=e.defineComponent({__name:"index",setup(g){const p=n.useUserStore(),{countryList:f,setCountryList:j}=m.useCountryCode(),q=e.ref("CN"),v=e.ref([]),k=e.reactive({phone:"",code:""}),x=e.computed((()=>s.getNeedValue(q.value,"code","tel",v.value))),{getCode:_,codeButtonText:y}=h.useCode(k,q,x),{showLanguagePopup:b,onShowLanguagePopup:C,onChangeLanguage:L,bannerImg:w}=h.useLang(),A={[o.Langs.zh]:"中文",[o.Langs.en]:"EN"},I=()=>{t.navigateTo(`/sub-pages/common/country-code/index?country=${q.value}&from=login`)},E=async()=>{if(v.value&&v.value.length?u.isRegCode(k.phone,q.value,v.value,"phone"):u.isInternationalPhone(k.phone))if(k.code)try{const{id:e,page:o}=p;await p.h5Login(e&&"home"===o?e:"",k.phone,{verification:k.code,phone:{country_code:x.value||"+86",phone_number:k.phone}});const n=await d.userApi.get();l.envEvent.report.start({_user_id:null==n?void 0:n.id,_anony_id:null==n?void 0:n.open_id}),p.setUserInfo({...n,login_country:q.value}),t.reLaunch("/pages/index/index")}catch(e){return}else i.toast(o.t("sub-pages.common.login.1"));else i.toast(o.t("pages.common.login.index.2"))},P=e.computed((()=>{const e=v.value&&v.value.length?u.isRegCode(k.phone,q.value,v.value,"phone"):u.isInternationalPhone(k.phone);return k.phone&&k.code&&e})),N=()=>{v.value=f.value.map((e=>({...e,text:`${e.name}-${e.enName} (${e.tel})`,value:e.code})))};e.onLoad((async()=>{a.unite.setNavigationBarTitle(o.t("pages.common.login.index.1")),(async()=>{f.value.length||await j(),N()})();const{id:e,page:n}=p;if(e&&"home"===n){const o=(await c.deviceApi.cabinetInfo({scene:e})).shop.country||"";q.value=o}}));const R=e.ref();return e.onShow((()=>{e.index.$once(r.EMIT_UPDATE_LOGIN_AREACODE,(e=>{q.value=e}))})),(n,s)=>e.e({a:e.unref(w),b:e.t(e.unref(o.t)("sub-pages.common.login.2")),c:e.unref(v)&&e.unref(v).length},e.unref(v)&&e.unref(v).length?{d:e.t(e.unref(x)),e:e.o(I)}:{},{f:e.unref(o.t)("pages.common.login.index.3"),g:e.unref(k).phone,h:e.o((o=>e.unref(k).phone=o.detail.value)),i:e.t(e.unref(o.t)("sub-pages.common.login.3")),j:e.unref(o.t)("sub-pages.common.login.1"),k:e.unref(k).code,l:e.o((o=>e.unref(k).code=o.detail.value)),m:e.t(e.unref(y)),n:e.o((o=>e.unref(_)(e.unref(v)))),o:e.t(e.unref(o.t)("pages.common.login.index.6")),p:e.t(e.unref(o.t)("pages.common.login.index.1")),q:e.o(E),r:e.p({isBlock:!0,disabled:!e.unref(P)}),s:e.f(A,((o,n,s)=>({a:e.t(o),b:n,c:e.n(e.unref(p).language===n?"active":""),d:e.o((o=>e.unref(L)(n)),n)}))),t:e.t(e.unref(o.t)("pages.common.login.index.7")),v:e.n(e.unref(p).language!==e.unref(o.Langs).zh&&e.unref(p).language!==e.unref(o.Langs).en?"active":""),w:e.o(((...o)=>e.unref(C)&&e.unref(C)(...o))),x:e.o(e.unref(L)),y:e.o((o=>e.isRef(b)?b.value=o:null)),z:e.p({visible:e.unref(b)}),A:e.sr(R,"9d50e824-2",{k:"ModalRef"}),B:e.p({id:"ModalRef"})})}}),f=e._export_sfc(p,[["__scopeId","data-v-9d50e824"]]);wx.createPage(f);
