"use strict";const e=require("../../../common/vendor.js"),o=require("../../../api/coupon.js");require("../../../store/modules/app.js");const r=require("../../../store/modules/device.js");require("../../../store/modules/order.js");const i=require("../../../store/modules/user.js"),s=require("../../../utils/config/index.js"),n=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../utils/uniAsync.js"),require("../../../utils/wx.log.js"),require("../../../hooks/uni-hooks/dialog.js"),require("../../../hooks/uni-hooks/request.js");const t=require("../../../hooks/uni-hooks/unite.js");if(require("../../../hooks/uni-hooks/wechat.js"),require("../../../hooks/useCountryCode.js"),require("../../../api/device.js"),require("../../../api/order.js"),require("../../../api/user.js"),require("../../../const/order.js"),require("../../../hooks/uni-hooks/router.js"),require("../../../hooks/usePromise.js"),require("../../../api/delivery.js"),require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../shared/device.js"),require("../../../const/common.js"),require("../../../utils/appEnterVerif.js"),require("../../../utils/config/env.js"),require("../../../const/platform.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../theme/hooks/useTheme.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),!Array){(e.resolveComponent("mot-button")+e.resolveComponent("mot-modal"))()}Math||((()=>"../../../uni_modules/mot-button/components/mot-button/mot-button.js")+(()=>"../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js"))();const u=e.defineComponent({__name:"index",setup(u){const a=i.useUserStore(),c=r.useDeviceStore(),l=e.reactive({loading:!1,canNextFlag:!1}),d=async()=>{console.log(s.config.client_id,s.config.mixc_app_id,s.config.MODE,"config.client_id");const o={appId:s.config.mixc_app_id,path:"pages/oauth/authorize",extraData:{response_type:"code",client_id:s.config.client_id,redirect_uri:"sub-pages/common/authorize/index",mall_code:"20076",scope:"",redirect_env_version:"development"===s.config.MODE?"trial":"release"},envVersion:"development"===s.config.MODE?"trial":"release",success(e){console.log(e,"Res")},fail(e){console.log(e,"fail")}};console.log(o,"params"),e.index.navigateToMiniProgram(o)},m=e=>{const o=e||{};a.setVipCoupon(o),c.goNextPage(2),l.loading=!1};e.onLoad((()=>{const e=setTimeout((()=>{l.canNextFlag=!0,clearTimeout(e)}),3e3)})),e.onShow((async()=>{var r;t.unite.setNavigationBarTitle(n.t("sub-pages.common.authorize.index.1"));const i=e.index.getEnterOptionsSync();console.log("启动参数:onShow",i);const{extraData:{code:s="",webServerRedirectUri:u=""}={}}=null==i?void 0:i.referrerInfo;if(s||l.canNextFlag)if(s){l.loading=!0;const e={code:s,vip_type:c.vipType,site_id:null==(r=null==c?void 0:c.site)?void 0:r.id,redirect_uri:u};o.vipApi.queryByPhone(e).then((e=>{console.log("[ data ] >",e),a.setUserInfo({...a.user}),m(e)})).catch((e=>{console.log("[ queryByPhone err ] >",e),m()})).finally((()=>{l.loading=!1}))}else m()}));const h=e.ref();return(o,r)=>({a:e.unref(s.config).fileBaseUrl+"/home/complete_information_bg.png",b:e.t(e.unref(n.t)("sub-pages.common.authorize.index.1")),c:e.t(e.unref(n.t)("sub-pages.common.authorize.index.2")),d:e.t(e.unref(l).loading?e.unref(n.t)("sub-pages.common.authorize.index.4"):e.unref(n.t)("sub-pages.common.authorize.index.3")),e:e.o(d),f:e.p({shape:"square",isBlock:!0,loading:e.unref(l).loading,disabled:e.unref(l).loading}),g:e.sr(h,"e5e1b6ce-1",{k:"ModalRef"}),h:e.p({id:"ModalRef"})})}}),a=e._export_sfc(u,[["__scopeId","data-v-e5e1b6ce"]]);wx.createPage(a);
