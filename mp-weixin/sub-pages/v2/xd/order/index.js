"use strict";const e=require("../../../../common/vendor.js"),r=require("../../../../local/index.js");require("../../../../hooks/uni-hooks/new-dialog.js"),require("../../../../store/modules/app.js"),require("../../../../store/modules/device.js"),require("../../../../store/modules/order.js"),require("../../../../store/modules/user.js");const o=require("../../../../const/order.js");require("../../../../utils/uniAsync.js"),require("../../../../utils/wx.log.js");const s=require("../../../../utils/config/index.js");require("../../../../hooks/uni-hooks/dialog.js");const i=require("../../../../hooks/uni-hooks/emitKey.js");require("../../../../hooks/uni-hooks/request.js");const a=require("../../../../hooks/uni-hooks/router.js");require("../../../../hooks/uni-hooks/wechat.js");const t=require("../../../../hooks/usePagination.js"),d=require("../../../../api/delivery.js");require("../../../../hooks/useCountryCode.js"),require("../../../../shared/order.js");const n=require("../../../../shared/pay.js"),u=require("../../../../shared/jd-order.js");if(require("../../../../hooks/uni-hooks/unite.js"),require("../../../../const/platform.js"),require("../../../../shared/cache.js"),require("../../../../const/cache.js"),require("../../../../hooks/uni-hooks/cache.js"),require("../../../../utils/config/env.js"),require("../../../../uni_modules/mot-utils/index.js"),require("../../../../theme/hooks/useTheme.js"),require("../../../../theme/hooks/themeConfig.js"),require("../../../../theme/hooks/themeKeys.js"),require("../../../../api/device.js"),require("../../../../api/order.js"),require("../../../../api/user.js"),require("../../../../hooks/usePromise.js"),require("../../../../shared/device.js"),require("../../../../const/common.js"),require("../../../../utils/appEnterVerif.js"),require("../../../../hooks/use-common.js"),require("../../../../hooks/uni-hooks/loading.js"),require("../../../../hooks/uni-hooks/common.js"),require("../../../../utils/url.js"),require("../../../../hooks/uni-hooks/report.js"),require("../../../../api/data.js"),require("../../../../hooks/useWechatSI.js"),require("../../../../hooks/use-keyval/index.js"),require("../../../../const/coupon.js"),require("../../../../utils/is.js"),!Array){(e.resolveComponent("mot-empty")+e.resolveComponent("mot-modal"))()}Math||(c+l+(()=>"../../../../uni_modules/mot-empty/components/mot-empty/mot-empty.js")+(()=>"../../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js")+m+p)();const c=()=>"../../../../components/mot-search/index.js",l=()=>"./components/order-item.js",m=()=>"./components/order-cancel-popup.js",p=()=>"../../../../components/special-model/jd-order-cancel-model/index.js",h=e.defineComponent({__name:"index",setup(c){const{query:l,useSkip:m}=t.usePagination(),p=e.ref(),h=e.reactive({searchValue:"",currentTab:"all",tabIndex:0,recordList:[{data:[],loadingText:"加载更多"}],cancelData:{usedTime:0,lockerAmount:0,totalPaid:0,actualPaid:0,paid:0,traceId:"",siteId:"",lockerId:"",orderId:"",lockerOrderId:"",payRule:{},expressFreeMinutes:0}}),j=e=>{const r=e.target.current||e.detail.current;h.tabIndex=r},{recordList:k,tabIndex:q}=e.toRefs(h);e.onLoad((e=>{g(h.tabIndex)})),e.onShow((()=>{e.index.$once(i.EMIT_REFRESH_JD_ORDER,(()=>{f()}))}));const f=()=>{l.page=1,l.lastPage=!1,h.recordList[h.tabIndex].data=[],h.recordList[h.tabIndex].loadingText="",g(h.tabIndex)},g=async e=>{if(l.loading||l.lastPage)return;l.loading=!0;const r={limit:l.limit,skip:m(),kuaidi_num:h.searchValue},o=h.recordList[e],s=await d.DeliveryApi.getLogisticOrderList(r).finally((()=>l.loading=!1));s.data.length===l.limit?l.page+=1:(l.lastPage=!0,o.loadingText="没有更多数据~"),o.data=o.data.concat(s.data)},_=e.ref(!1),I=async e=>{const{id:r,site_id:o,locker_id:s,pay_rule:i,paid:a,locker_order_id:t,info:n}=e,{paid:c,total_paid:l,trace_id:m,info:p={}}=await d.DeliveryApi.getExpressPaid({order_id:r,site_id:o,is_cancel:!0}),{express_free_minutes:j=0}=n,{used_time:k=0,locker_amount:q=0}=p,f={usedTime:k,lockerAmount:q,paid:a,actualPaid:c,totalPaid:l,traceId:m,siteId:o,lockerId:s,orderId:r,lockerOrderId:t,payRule:i,expressFreeMinutes:j};h.cancelData={...f},c>0?_.value=!0:u.onCancelOrder(r,m)},x=async()=>{const{actualPaid:e,traceId:r,siteId:s,lockerId:i,orderId:t,lockerOrderId:d}=h.cancelData,{display_id:u}=await n.topUp({payed:e,site_id:s,order_data:{cancel:!0,order_id:t,site_id:s,locker_id:i,trace_id:r,locker_order_id:d}},o.PayOrderTypeEnum.JdCancel);let c=`/pages/order/unlock/index?from=${o.OrderResultEnum.JDCANCEL}&orderId=${h.cancelData.orderId}&displayId=${u}&traceId=${r}`;a.navigateTo(c)},y=e.ref();return(o,i)=>{var a,t;return e.e({a:e.o(f),b:e.o((r=>e.unref(h).searchValue=r)),c:e.p({placeholder:"请输入运单号",modelValue:e.unref(h).searchValue}),d:(null==(a=e.unref(k)[e.unref(q)])?void 0:a.data.length)>0},(null==(t=e.unref(k)[e.unref(q)])?void 0:t.data.length)>0?{e:e.f(e.unref(k),((r,o,s)=>e.e({a:e.f(r.data,((r,o,i)=>({a:e.o(I,r.id),b:"b6c5b9c0-1-"+s+"-"+i,c:e.p({order:r}),d:r.id}))),b:e.unref(l).loading||r.data.length>0},e.unref(l).loading||r.data.length>0?{c:e.t(r.loadingText)}:{},{d:e.o((e=>(e=>{const r=setTimeout((()=>{g(h.tabIndex),clearTimeout(r)}),500)})()),o),e:o}))),f:e.unref(q),g:e.o(j)}:{h:e.p({description:e.unref(r.t)("common.no_data"),image:e.unref(s.config).fileBaseUrl+"/order_empty.png"})},{i:e.sr(y,"b6c5b9c0-3",{k:"ModalRef"}),j:e.p({id:"ModalRef"}),k:e.o(x),l:e.o((r=>e.isRef(_)?_.value=r:null)),m:e.p({data:e.unref(h).cancelData,visible:e.unref(_)}),n:e.sr(p,"b6c5b9c0-5",{k:"cancelRef"})})}}}),j=e._export_sfc(h,[["__scopeId","data-v-b6c5b9c0"]]);wx.createPage(j);
