"use strict";const e=require("../../../../common/vendor.js"),r=require("../../../../local/index.js"),o=require("../../../../hooks/uni-hooks/common.js"),t=require("../../../../hooks/uni-hooks/dialog.js");require("../../../../hooks/uni-hooks/request.js");const n=require("../../../../hooks/uni-hooks/router.js"),s=require("../../../../utils/format.js"),u=require("../../../../const/order.js");require("../../../../utils/uniAsync.js"),require("../../../../utils/wx.log.js");const i=require("../../../../utils/config/index.js");require("../../../../hooks/uni-hooks/wechat.js");const d=require("../../../../hooks/useWechatSI.js");require("../../../../store/modules/app.js");const c=require("../../../../store/modules/device.js");require("../../../../store/modules/order.js"),require("../../../../store/modules/user.js"),require("../../../../hooks/useCountryCode.js");const a=require("../../../../api/order.js"),m=require("../../../../api/delivery.js");if(require("../../../../hooks/uni-hooks/new-dialog.js"),require("../../../../uni_modules/mot-utils/index.js"),require("../../../../theme/hooks/useTheme.js"),require("../../../../theme/hooks/themeConfig.js"),require("../../../../theme/hooks/themeKeys.js"),require("../../../../hooks/uni-hooks/unite.js"),require("../../../../const/platform.js"),require("../../../../shared/cache.js"),require("../../../../const/cache.js"),require("../../../../hooks/uni-hooks/cache.js"),require("../../../../utils/config/env.js"),require("../../../../utils/url.js"),require("../../../../hooks/use-common.js"),require("../../../../api/user.js"),require("../../../../hooks/uni-hooks/loading.js"),require("../../../../hooks/uni-hooks/report.js"),require("../../../../api/device.js"),require("../../../../hooks/usePromise.js"),require("../../../../shared/device.js"),require("../../../../const/common.js"),require("../../../../utils/appEnterVerif.js"),require("../../../../api/data.js"),!Array){(e.resolveComponent("mot-button")+e.resolveComponent("mot-modal"))()}Math||((()=>"../../../../uni_modules/mot-button/components/mot-button/mot-button.js")+(()=>"../../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js"))();const l=e.defineComponent({__name:"index",setup(l){const p=c.useDeviceStore(),{autoPlay:q}=d.useWechatSI(),h=e.reactive({openCount:0,maxCount:3,from:u.OrderResultEnum.CREATE,order:{},orderId:"",traceId:"",code:"1601",codeMap:{1601:{name:r.t("sub-pages.order.exception.mqtt.index.7"),desc:r.t("hooks.uni-hooks.request.6")},1705:{name:r.t("sub-pages.order.exception.mqtt.index.10"),desc:r.t("sub-pages.order.exception.mqtt.index.11")}}}),f={1601:r.t("sub-pages.order.exception.mqtt.index.13"),1705:r.t("sub-pages.order.exception.mqtt.index.14")};e.onLoad((e=>{const{orderId:r,from:o=u.OrderResultEnum.CREATE,code:t="1601",traceId:n}=e||{};h.from=o,h.code=t,h.orderId=r,h.traceId=n,async function(e){const r=[u.OrderResultEnum.JDCREATE,u.OrderResultEnum.JDCANCEL].includes(h.from)?m.DeliveryApi.getLogisticOrderDetail:a.lockerOrderApi.get;h.order=await r(e),q(f[h.code])}(r)}));const x=()=>{if(h.openCount>=h.maxCount){const e=h.codeMap[h.code].name;t.showModal({title:e,content:`${r.t("sub-pages.order.exception.mqtt.index.16")}:${i.common.servicePhoneText}`,cancelText:r.t("sub-pages.order.exception.mqtt.index.17"),confirmText:r.t("sub-pages.order.exception.mqtt.index.18")}).then((()=>{const e={};h.from===u.OrderResultEnum.JDCREATE?e.cancel=!1:h.from===u.OrderResultEnum.JDCANCEL?(e.cancel=!0,e.traceId=h.traceId):e.end=h.from===u.OrderResultEnum.DONE,p.open(h.orderId,e,{ignore1705:!0},h.from).then(E)})).catch((()=>{o.makePhoneCall(i.common.servicePhone)}))}else t.showModal({title:r.t("hooks.uni-hooks.dialog.5"),content:`${r.t("sub-pages.order.exception.mqtt.index.16")}:${i.common.servicePhoneText}`}).then((()=>{h.openCount+=1;const e={};h.from===u.OrderResultEnum.JDCREATE?e.cancel=!1:h.from===u.OrderResultEnum.JDCANCEL?(e.cancel=!0,e.traceId=h.traceId):e.end=h.from===u.OrderResultEnum.DONE,p.open(h.orderId,e,{ignore1705:!0},h.from).then(E)}))},k=()=>{t.showModal({title:r.t("sub-pages.order.exception.mqtt.index.21"),content:r.t("sub-pages.order.exception.mqtt.index.22")}).then((()=>{a.lockerOrderApi.end(h.orderId,{payed:0,remark:r.t("order.question.unlock.unlock_confirm_cancel_btn")}).then((()=>{t.dialog.alert(r.t("sub-pages.order.exception.mqtt.index.24"),r.t("sub-pages.order.exception.mqtt.index.25"),r.t("sub-pages.order.exception.mqtt.index.26")).then((()=>{n.navigateTo("/pages/v1/deposit/index")}))}))}))},j=()=>{t.showModal({title:r.t("sub-pages.order.exception.mqtt.index.27"),content:r.t("sub-pages.order.exception.mqtt.index.28")}).then((()=>{a.lockerOrderApi.end(h.orderId,{remark:`${r.t("sub-pages.order.exception.mqtt.index.29")}(${h.code})`}).then(E)}))},E=()=>{[u.OrderResultEnum.JDCREATE,u.OrderResultEnum.JDCANCEL].includes(h.from)?n.redirectTo(`/sub-pages/v2/xd/result/index?orderId=${h.orderId}&from=${h.from}`):n.redirectTo(`/pages/order/result/index?orderId=${h.orderId}&from=${h.from}`)},{codeMap:g,code:b,from:C,order:R}=e.toRefs(h),O=e.ref();return(o,t)=>{var n,i;return e.e({a:e.t(e.unref(s.fullLockerName)(null==(n=e.unref(R).info)?void 0:n.locker_name,null==(i=e.unref(R).info)?void 0:i.cabinet_address)),b:e.t(e.unref(r.t)("common.unit.no")),c:e.t(e.unref(g)[e.unref(b)].name),d:e.t(e.unref(g)[e.unref(b)].desc),e:e.t(e.unref(r.t)("sub-pages.order.exception.mqtt.index.2")),f:e.o(x),g:e.p({shape:"square",isBlock:!0}),h:e.unref(C)===e.unref(u.OrderResultEnum).DONE},e.unref(C)===e.unref(u.OrderResultEnum).DONE?{i:e.t(e.unref(r.t)("order.question.cabinet.alert_title")),j:e.o(j),k:e.p({shape:"square",type:"info",isBlock:!0,plain:!0})}:{l:e.t(e.unref(r.t)("order.question.unlock.unlock_confirm_btn")),m:e.o(E),n:e.p({shape:"square",type:"info",isBlock:!0,plain:!0})},{o:e.unref(C)===e.unref(u.OrderResultEnum).CREATE},e.unref(C)===e.unref(u.OrderResultEnum).CREATE?{p:e.t(e.unref(r.t)("pages.result.door-stuck.index.5")),q:e.o(k)}:{},{r:e.sr(O,"e4e080a0-3",{k:"ModalRef"}),s:e.p({id:"ModalRef"})})}}}),p=e._export_sfc(l,[["__scopeId","data-v-e4e080a0"]]);wx.createPage(p);
