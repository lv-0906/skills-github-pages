"use strict";const e=require("../../../common/vendor.js"),r=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../store/modules/app.js"),require("../../../store/modules/device.js"),require("../../../store/modules/order.js"),require("../../../store/modules/user.js");const t=require("../../../utils/dayjs.js"),u=require("../../../utils/format.js"),n=require("../../../utils/order.js");require("../../../utils/uniAsync.js");const o=require("../../../utils/validate.js");require("../../../utils/wx.log.js");const s=require("../../../utils/config/index.js"),i=require("../../../hooks/uni-hooks/dialog.js");require("../../../hooks/uni-hooks/request.js");const a=require("../../../hooks/uni-hooks/unite.js");require("../../../hooks/uni-hooks/wechat.js"),require("../../../hooks/useCountryCode.js");const d=require("../../../hooks/use-mix.js"),f=require("../../../api/order.js"),l=require("../../../const/order.js"),c=require("../../../hooks/use-keyval/index.js"),p=require("../../../shared/order.js");require("../../../shared/pay.js");const m=require("../../../shared/coupon.js"),h=require("../../../hooks/business/use-order-btn-opt.js");if(require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../utils/config/env.js"),require("../../../const/platform.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../theme/hooks/useTheme.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),require("../../../api/device.js"),require("../../../api/user.js"),require("../../../hooks/uni-hooks/router.js"),require("../../../hooks/usePromise.js"),require("../../../api/delivery.js"),require("../../../shared/device.js"),require("../../../const/common.js"),require("../../../utils/appEnterVerif.js"),require("../../../const/coupon.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),require("../../../utils/precision.js"),require("../../../hooks/useWechatSI.js"),require("../../../utils/is.js"),!Array){(e.resolveComponent("mot-button")+e.resolveComponent("mot-modal"))()}Math||((()=>"../../../uni_modules/mot-button/components/mot-button/mot-button.js")+_+y+v+(()=>"../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js"))();const _=()=>"../../../components/business/slide-popup/index.js",y=()=>"../../../components/business/recharge-popup/index.js",v=()=>"../../../components/special-model/order-close-model/index.js",k=e.defineComponent({__name:"index",setup(_,{expose:y}){const{DepositTypeTextMap:v,LockerTypeTextMap:k,TicketStatusTextMap:j,RentalPeriodTextMap:q}=c.useKeyval(),T=e.ref(),w=s.config.fileBaseUrl+"/avatar.png",g=e.reactive({showSlid:!1,order:{info:{}},records:[]}),S=e.computed((()=>{const{status:e,ticket_status:r,payed:t,info:{shop_invoice_enable:u}}=g.order,n=e===l.OrderStatusEnum.Done&&u&&t>0;return{isShowUnissued:r===l.TicketStatus.UNISSUED,isShowProcess:r===l.TicketStatus.IN_PROGRESS,isshowTickets:n,isShowUrl:r!==l.TicketStatus.FAILED}}));e.onLoad((e=>{const{orderId:r}=e||{};E(r)})),e.onShow((()=>{a.unite.setNavigationBarTitle(r.t("order.detail.title"))}));const E=async e=>{[g.order,g.records]=await Promise.all([f.lockerOrderApi.get(e),f.orderApi.records(e)])},{useBtnOperateState:b,cbOrderItem:O,cbRenew:R,cbSlideConfirm:x}=h.useBtnOperate((()=>E(g.order.id))),P=e=>{if(e.status===l.OrderStatusEnum.Progressing&&e.deposit){const r=e.payed+e.deposit;return d.useToYuan(r)}return d.useToYuan(e.payed)},{order:D,records:C}=e.toRefs(g),I=e.computed((()=>{var e;const{pay_rule:r,status:t}=g.order;return(null==r?void 0:r.type)!==l.OrderRentTypeEnum.Count&&t===l.OrderStatusEnum.Progressing||(null==r?void 0:r.type)===l.OrderRentTypeEnum.Count&&(null==(e=null==r?void 0:r.cost)?void 0:e.owing_time_type)===l.rulesExpiredTypeEnum.PAY&&t===l.OrderStatusEnum.Progressing})),M=async()=>{const{id:e}=D.value,r=await f.createTicketsApi.post(e);(null==r?void 0:r.url)&&U(null==r?void 0:r.url).then((()=>{E(e)}))},U=t=>new Promise((u=>{e.index.setClipboardData({data:t,success:function(){e.index.showToast({title:r.t("order.detail.copy_success"),icon:"success"}),u(!0)}})})),A=()=>{var t;const u=null==(t=g.order.info)?void 0:t.location_overview_url;u?e.index.previewImage({urls:[u]}):i.toast(r.t("order.detail.btn.no_image"))},B=()=>{O({type:l.OrderButtonEnum.Close,order:g.order})},F=e.ref();return y({ModalRef:F}),(s,i)=>{var a,f,c,h,_,y,g,E,L,Y,N,K,V,G,Z,z,H,J;return e.e({a:"overflow:"+(e.unref(b).showRecharge?"hidden":"visible"),b:e.t(e.unref(p.showOrderStatusText)(e.unref(D))),c:e.t(e.unref(r.t)("order.detail.desc.used_time")),d:e.t(e.unref(u.numberToZhTime)(e.unref(D).used_time)),e:e.t(e.unref(r.t)("order.detail.desc.payed")),f:e.t(e.unref(d.useToYuan)(e.unref(D).payed)),g:e.unref(D).status===e.unref(l.OrderStatusEnum).Done?1:"",h:e.unref(D).status===e.unref(l.OrderStatusEnum).Progressing?1:"",i:e.unref(p.showOwing)(e.unref(D))&&!e.unref(p.isReserve)(e.unref(D))?1:"",j:e.unref(D).info},e.unref(D).info?e.e({k:e.t(e.unref(r.t)("order.detail.nickname")),l:e.t(e.unref(D).info.user_nickname||"-"),m:e.t(e.unref(r.t)("order.detail.site_name")),n:e.t(e.unref(D).info.site_name),o:null==(a=e.unref(D).info)?void 0:a.location_overview_enable},(null==(f=e.unref(D).info)?void 0:f.location_overview_enable)?{p:e.t(e.unref(r.t)("order.detail.location_url")),q:e.t(e.unref(r.t)("order.result.formLabels.viewDetails")),r:e.o(A)}:{},{s:e.t(e.unref(r.t)("order.detail.site_address")),t:e.t(e.unref(D).info.site_address||"-"),v:e.t(e.unref(r.t)("order.detail.cabinet_info")),w:e.t(e.unref(u.fullLockerName)(e.unref(D).info.locker_name,e.unref(D).info.cabinet_address)),x:e.t(e.unref(r.t)("common.unit.no")),y:e.t(e.unref(k)[e.unref(D).info.locker_type])}):{},{z:e.t(e.unref(r.t)("order.detail.order_no")),A:e.t(e.unref(D).id),B:e.t(e.unref(r.t)("order.detail.order_money")),C:e.t(e.unref(d.useToYuan)(e.unref(D).money)),D:e.unref(D).coupon},e.unref(D).coupon?{E:e.t(e.unref(r.t)("order.detail.coupon")),F:e.t(e.unref(D).coupon.name),G:e.t(e.unref(m.showOrderCouponMoney)(e.unref(D)))}:{},{H:e.t(e.unref(r.t)("order.detail.order_payed")),I:e.t(P(e.unref(D))),J:e.unref(D).status===e.unref(l.OrderStatusEnum).Progressing},e.unref(D).status===e.unref(l.OrderStatusEnum).Progressing?{K:e.t(e.unref(r.t)("order.detail.order_deposit")),L:e.t(e.unref(d.useToYuan)(e.unref(D).deposit))}:{},{M:e.t(e.unref(r.t)("order.detail.used_time")),N:e.t(e.unref(u.numberToZhTime)(e.unref(D).used_time)),O:e.unref(p.isReserve)(e.unref(D))},e.unref(p.isReserve)(e.unref(D))?{P:e.t(e.unref(r.t)("order.detail.excluding_reservation_time"))}:{},{Q:e.unref(D).status===e.unref(l.OrderStatusEnum).Done},e.unref(D).status===e.unref(l.OrderStatusEnum).Done?{R:e.t(e.unref(r.t)("order.detail.end_at")),S:e.t(e.unref(t.format)(e.unref(D).end_at))}:{},{T:e.t(e.unref(r.t)("order.detail.fetch_type")),U:e.t(e.unref(v)[e.unref(D).fetch_type]),V:e.unref(D).fetch_type!==e.unref(l.DepositTypeEnum).IdCard},e.unref(D).fetch_type!==e.unref(l.DepositTypeEnum).IdCard?e.e({W:e.t(e.unref(r.t)("order.detail.fetch_phone")),X:e.t(e.unref(D).fetch_type===e.unref(l.DepositTypeEnum).FaceId||e.unref(D).fetch_type===e.unref(l.DepositTypeEnum).FacePad?e.unref(r.t)("order.detail.fetch_face"):e.unref(r.t)("order.detail.fetch_password")),Y:e.t(e.unref(o.to344Phone)(e.unref(D).phone)),Z:e.unref(D).fetch_type===e.unref(l.DepositTypeEnum).FaceId||e.unref(D).fetch_type===e.unref(l.DepositTypeEnum).FacePad},e.unref(D).fetch_type===e.unref(l.DepositTypeEnum).FaceId||e.unref(D).fetch_type===e.unref(l.DepositTypeEnum).FacePad?{aa:e.unref(D).info.face_url||w}:{}):{},{ab:e.unref(D).pay_rule},e.unref(D).pay_rule?e.e({ac:e.t(e.unref(r.t)("order.detail.pay_rule_title")),ad:e.t(e.unref(D).pay_rule.name),ae:e.t(e.unref(n.showRentTypeText)(null==(h=null==(c=e.unref(D))?void 0:c.pay_rule)?void 0:h.type)),af:(null==(y=null==(_=e.unref(D))?void 0:_.pay_rule)?void 0:y.type)===e.unref(l.OrderRentTypeEnum).Time},(null==(E=null==(g=e.unref(D))?void 0:g.pay_rule)?void 0:E.type)===e.unref(l.OrderRentTypeEnum).Time?{ag:e.t(e.unref(r.t)("order.detail.rental_period")),ah:e.t(e.unref(q)[null==(Y=null==(L=e.unref(D))?void 0:L.pay_rule)?void 0:Y.rental_period])}:{},{ai:null==(K=null==(N=e.unref(D))?void 0:N.pay_rule)?void 0:K.cost},(null==(G=null==(V=e.unref(D))?void 0:V.pay_rule)?void 0:G.cost)?{aj:e.t(e.unref(r.t)("order.detail.free_time")),ak:e.t(e.unref(D).pay_rule.cost.free_time||0),al:e.t(e.unref(r.t)("common.unit.minute"))}:{},{am:e.t(e.unref(r.t)("order.detail.pay_rule_desc")),an:e.t(e.unref(D).pay_rule.title||"-")}):{},{ao:e.unref(S).isshowTickets},e.unref(S).isshowTickets?e.e({ap:e.t(e.unref(r.t)("order.detail.ticket_status")),aq:e.t(e.unref(j)[e.unref(D).ticket_status]||"-"),ar:e.t(e.unref(S).isShowProcess?e.unref(r.t)("order.detail.ticket_create_url"):e.unref(r.t)("order.detail.ticket_download_url")),as:(null==(z=null==(Z=e.unref(D))?void 0:Z.info)?void 0:z.ticket_url)&&e.unref(S).isShowUrl},(null==(J=null==(H=e.unref(D))?void 0:H.info)?void 0:J.ticket_url)&&e.unref(S).isShowUrl?{at:e.t(e.unref(r.t)("order.detail.copy_link")),av:e.o((r=>U(e.unref(D).info.ticket_url)))}:{aw:e.t("-")}):{},{ax:e.t(e.unref(r.t)("order.detail.record_title")),ay:e.f(e.unref(C),((r,u,n)=>({a:e.t(e.unref(t.format)(r.date)),b:e.t(r.desc),c:r.id}))),az:e.unref(D).status===e.unref(l.OrderStatusEnum).Progressing&&!e.unref(p.isReserve)(e.unref(D))},e.unref(D).status!==e.unref(l.OrderStatusEnum).Progressing||e.unref(p.isReserve)(e.unref(D))?{}:{aA:e.t(e.unref(r.t)("order.detail.btn.close")),aB:e.o(B),aC:e.p({shape:"square"})},{aD:e.unref(I)&&!e.unref(p.isReserve)(e.unref(D))},e.unref(I)&&!e.unref(p.isReserve)(e.unref(D))?{aE:e.t(e.unref(D).pay_rule.prepaid>0?e.unref(r.t)("order.detail.btn.renewal"):e.unref(r.t)("order.detail.btn.free_renewal")),aF:e.o((r=>e.unref(O)({type:e.unref(l.OrderButtonEnum).Renew,order:e.unref(D)}))),aG:e.p({type:"primary",shape:"square"})}:{},{aH:e.unref(S).isShowUnissued&&e.unref(S).isshowTickets},e.unref(S).isShowUnissued&&e.unref(S).isshowTickets?{aI:e.t(e.unref(r.t)("order.detail.btn.create_ticket")),aJ:e.o(M),aK:e.p({shape:"square",isBlock:!0})}:{},{aL:e.o(e.unref(x)),aM:e.o((r=>e.unref(b).showSlid=r)),aN:e.p({type:e.unref(b).slidType,modelValue:e.unref(b).showSlid}),aO:e.o(e.unref(R)),aP:e.o((r=>e.unref(b).showRecharge=r)),aQ:e.p({order:e.unref(b).order,modelValue:e.unref(b).showRecharge}),aR:e.sr(T,"7934cf48-5",{k:"closeRef"}),aS:e.sr(F,"7934cf48-6",{k:"ModalRef"}),aT:e.p({id:"ModalRef"})})}}}),j=e._export_sfc(k,[["__scopeId","data-v-7934cf48"]]);wx.createPage(j);
