"use strict";const e=require("../../../common/vendor.js"),r=require("../../../const/order.js"),o=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../store/modules/app.js");const s=require("../../../store/modules/device.js");require("../../../store/modules/order.js"),require("../../../store/modules/user.js"),require("../../../utils/uniAsync.js"),require("../../../utils/wx.log.js");const i=require("../../../utils/config/index.js"),u=require("../../../hooks/uni-hooks/dialog.js"),n=require("../../../hooks/uni-hooks/emitKey.js");require("../../../hooks/uni-hooks/request.js");const t=require("../../../hooks/uni-hooks/router.js"),d=require("../../../hooks/uni-hooks/unite.js");require("../../../hooks/uni-hooks/wechat.js");const a=require("../../../hooks/useWechatSI.js");require("../../../hooks/useCountryCode.js"),require("../../../shared/order.js");const c=require("../../../shared/pay.js");if(require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../utils/config/env.js"),require("../../../const/platform.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../theme/hooks/useTheme.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),require("../../../api/device.js"),require("../../../api/order.js"),require("../../../api/user.js"),require("../../../hooks/usePromise.js"),require("../../../api/delivery.js"),require("../../../shared/device.js"),require("../../../const/common.js"),require("../../../utils/appEnterVerif.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),require("../../../hooks/use-keyval/index.js"),require("../../../const/coupon.js"),require("../../../utils/is.js"),!Array){e.resolveComponent("mot-modal")()}Math||(m+(()=>"../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js"))();const m=()=>"../../../components/business/wait-open/index.js",p=e.defineComponent({__name:"index",setup(m){const p=s.useDeviceStore(),{autoPlay:l}=a.useWechatSI(),h=e.reactive({from:r.PayOrderTypeEnum.Create,payed:0,displayId:"",payHalfUnlock:!1});e.onLoad((e=>{const{displayId:s,from:i=r.PayOrderTypeEnum.Create,payed:u,payHalfUnlock:n}=e||{};if(h.from=Number(i),h.displayId=s,h.payHalfUnlock=n,l(o.t("sub-pages.order.open.index.1")),s)return q(s),void(h.payed=u);d.unite.setNavigationBarTitle(o.t("order.detail.btn.pay_unlock"))}));const q=async e=>{const s=r.PayOrderTypeEnumMap[h.from].order_result_type;try{const{promise:r}=c.transactionPreOrderResult(e),o=await r,{order:i}=o,{err_code:u,id:n}=i||{};if(1705===u||1601===u){const e=`${s}&orderId=${n}&code=${u}`;return void t.reLaunch(`/sub-pages/order/exception/mqtt/index?from=${e}`)}j(i.id)}catch(i){const{msg:e=o.t("sub-pages.order.open.index.5"),code:n=400}=i||{};return void u.dialog.alert(`${e}(${n})`).then((()=>{[r.OrderResultEnum.JDCREATE,r.OrderResultEnum.JDCANCEL].includes(s)?t.reLaunch("/sub-pages/v2/xd/home/index"):t.goHome()}))}},j=async s=>{if(h.from===r.PayOrderTypeEnum.Coupon)return void t.reLaunch(`/sub-pages/me/coupon-result/index?orderId=${s}`);if(h.from===r.PayOrderTypeEnum.Renew)return u.toast(o.t("pages.v1.index.index.21")),h.payHalfUnlock&&await p.open(s,{},{catchError:!0,homePage:!1}),e.index.$emit(n.EMIT_REFRESH_HOME),void t.goHome();if(h.from===r.PayOrderTypeEnum.RenewEnd)return void y(s);const i=r.PayOrderTypeEnumMap[h.from].order_result_type;[r.OrderResultEnum.FORGET,r.OrderResultEnum.JDCANCEL].includes(i)?t.reLaunch(`/sub-pages/v2/xd/result/index?orderId=${s}&from=${i}`):t.reLaunch(`/pages/order/result/index?orderId=${s}&from=${i}`)},y=async e=>{const o={end:!0};await p.open(e,o,{ignore1705:!1});const s=r.PayOrderTypeEnumMap[h.from].order_result_type;t.reLaunch(`/pages/order/result/index?orderId=${e}&from=${s}`)},k=()=>{u.dialog.alert(`${o.t("sub-pages.order.exception.mqtt.index.16")}:${i.common.servicePhoneText}`,o.t("hooks.uni-hooks.dialog.5")).then((()=>{t.goHome()}))},f=()=>{t.goHome()},g=e.ref();return(r,o)=>({a:e.o(f),b:e.o(k),c:e.p({payed:e.unref(h).payed}),d:e.sr(g,"57fe79a8-1",{k:"ModalRef"}),e:e.p({id:"ModalRef"})})}});wx.createPage(p);
