"use strict";const e=require("../../../common/vendor.js"),r=require("../../../api/device.js"),o=require("../../../api/order.js"),s=require("../../../local/index.js"),t=require("../../../hooks/uni-hooks/new-dialog.js");require("../../../store/modules/app.js");const n=require("../../../store/modules/device.js");require("../../../store/modules/order.js"),require("../../../store/modules/user.js");const i=require("../../../utils/dayjs.js"),u=require("../../../utils/format.js"),d=require("../../../const/order.js");require("../../../utils/uniAsync.js"),require("../../../utils/wx.log.js");const a=require("../../../utils/config/index.js");require("../../../hooks/uni-hooks/dialog.js"),require("../../../hooks/uni-hooks/request.js");const f=require("../../../hooks/uni-hooks/router.js"),l=require("../../../hooks/uni-hooks/unite.js"),c=require("../../../hooks/uni-hooks/wechat.js"),m=require("../../../hooks/usePromise.js");require("../../../hooks/useCountryCode.js"),require("../../../shared/order.js");const g=require("../../../shared/pay.js");if(require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../utils/config/env.js"),require("../../../const/platform.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../theme/hooks/useTheme.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),require("../../../api/user.js"),require("../../../api/delivery.js"),require("../../../shared/device.js"),require("../../../const/common.js"),require("../../../utils/appEnterVerif.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),require("../../../hooks/useWechatSI.js"),require("../../../hooks/use-keyval/index.js"),require("../../../const/coupon.js"),require("../../../utils/is.js"),!Array){(e.resolveComponent("mot-button")+e.resolveComponent("mot-modal"))()}Math||((()=>"../../../uni_modules/mot-button/components/mot-button/mot-button.js")+(()=>"../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js"))();const p=e.defineComponent({__name:"index",setup(p){const h=n.useDeviceStore(),j=e.reactive({showOne:!0,loading:!1,orders:[],order:{}});e.onLoad((()=>{q(),l.unite.setNavigationBarTitle(s.t("sub-pages.order.deposit.index.39"))}));const q=async()=>{const[e,r]=i.diffOne(),s=await o.lockerOrderApi.find({status:d.OrderStatusEnum.Done,limit:5,skip:0,end_at__gte:e,end_at__lte:r}),[t]=s||[];s.length>0&&(j.order=t,j.orders=s)},k=async e=>{if(j.loading)return;j.loading=!0;const{end_at:o,id:n,forget_count:u,pay_rule:l,locker_id:c,site_id:p,cabinet_id:h,info:q}=e;if(null==q?void 0:q.forget_disabled)return t.alert(s.t("sub-pages.order.forget.index.26")),void(j.loading=!1);const k=b(l);if(!k||u>k)return t.alert(`${s.t("sub-pages.order.forget.index.21")}: ${a.common.servicePhoneText}`),void(j.loading=!1);if(i.diff(o,new Date,"minute")/60>24)return t.alert(s.t("sub-pages.order.forget.index.23"),s.t("sub-pages.order.forget.index.25")),void(j.loading=!1);const[_,v]=await m.usePromise(r.deviceApi.locker(h,q.locker_type,c,void 0,!0));if(_){j.loading=!1;const{ErrCode:e=5001,ErrMsg:r=s.t("sub-pages.order.deposit.index.37")}=_||{};return void t.alert(`${r}(${e})`)}console.log("[ onSelected freeLocker ] >",v);const{forget_paid:x}=l;if(x>0){const r=await g.topUp({site_id:p,payed:x,order_data:{order_id:n,forget:!0}},d.PayOrderTypeEnum.Forget,e.info.pay_channel).finally((()=>{j.loading=!1})),{display_id:o}=r||{},s=`${d.OrderResultEnum.FORGET}&orderId=${n}&displayId=${o}`;return console.log("[ forget preData ] >",o,r,s),void f.navigateTo(`/pages/order/unlock/index?from=${s}`)}f.navigateTo(`/pages/order/unlock/index?orderId=${n}&from=${d.OrderResultEnum.FORGET}`).then((()=>{j.loading=!1}))},_=()=>{c.envEvent.scanCode().then((e=>{v(e)}))},v=async e=>{await h.fetchCabinet(e),h.goNextPage()},b=e=>e&&e.forget_count,{order:x,orders:y,showOne:w}=e.toRefs(j),E=e.ref();return(r,o)=>e.e({a:e.t(e.unref(s.t)("sub-pages.order.forget.index.1")),b:e.unref(y).length>0},e.unref(y).length>0?e.e({c:e.unref(w)},e.unref(w)?e.e({d:e.unref(x).info},e.unref(x).info?{e:e.t(e.unref(x).info.site_name),f:e.t(e.unref(u.fullLockerName)(e.unref(x).info.locker_name,e.unref(x).info.cabinet_address)),g:e.t(e.unref(s.t)("common.unit.no")),h:e.t(e.unref(s.t)("sub-pages.order.deposit.index.30"))}:{},{i:e.t(e.unref(s.t)("sub-pages.order.forget.index.8")),j:e.t(e.unref(i.format)(e.unref(x).start_at)),k:e.t(e.unref(s.t)("order.detail.end_at")),l:e.t(e.unref(i.format)(e.unref(x).end_at)),m:e.t(e.unref(s.t)("sub-pages.order.forget.index.10")),n:e.o((r=>k(e.unref(x))))}):{o:e.f(e.unref(y),((r,o,t)=>{var n,d,a;return e.e({a:r.info},r.info?{b:e.t(null==(n=r.info)?void 0:n.site_name),c:e.t(e.unref(u.fullLockerName)(null==(d=r.info)?void 0:d.locker_name,null==(a=r.info)?void 0:a.cabinet_address)),d:e.t(e.unref(s.t)("common.unit.no")),e:e.t(e.unref(s.t)("sub-pages.order.deposit.index.30"))}:{},{f:e.t(e.unref(i.format)(r.start_at)),g:e.t(e.unref(i.format)(r.end_at)),h:e.o((e=>k(r)),r.id),i:r.id})})),p:e.t(e.unref(s.t)("sub-pages.order.forget.index.8")),q:e.t(e.unref(s.t)("order.detail.end_at")),r:e.t(e.unref(s.t)("sub-pages.order.forget.index.10"))},{s:e.unref(w)},e.unref(w)?{t:e.t(e.unref(s.t)("sub-pages.order.forget.index.16")),v:e.o((e=>w.value=!1))}:{},{w:e.t(e.unref(s.t)("sub-pages.order.forget.index.18")),x:e.o(_),y:e.p({shape:"square",isBlock:!0})}):{z:e.t(e.unref(s.t)("sub-pages.order.forget.index.19"))},{A:e.sr(E,"8b28a82c-1",{k:"ModalRef"}),B:e.p({id:"ModalRef"})})}}),h=e._export_sfc(p,[["__scopeId","data-v-8b28a82c"]]);wx.createPage(h);
