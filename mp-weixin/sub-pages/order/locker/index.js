"use strict";const e=require("../../../common/vendor.js"),r=require("../../../const/common.js"),o=require("../../../const/site.js"),s=require("../../../const/emit.js"),i=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../store/modules/app.js");const t=require("../../../store/modules/device.js");require("../../../store/modules/order.js");const n=require("../../../store/modules/user.js"),u=require("../../../utils/clone.js"),d=require("../../../utils/format.js");require("../../../utils/uniAsync.js"),require("../../../utils/wx.log.js"),require("../../../utils/config/index.js"),require("../../../hooks/uni-hooks/dialog.js"),require("../../../hooks/uni-hooks/request.js");const a=require("../../../hooks/uni-hooks/router.js"),c=require("../../../hooks/uni-hooks/unite.js");if(require("../../../hooks/uni-hooks/wechat.js"),require("../../../hooks/useCountryCode.js"),require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../utils/config/env.js"),require("../../../const/platform.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../theme/hooks/useTheme.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),require("../../../api/device.js"),require("../../../api/order.js"),require("../../../api/user.js"),require("../../../const/order.js"),require("../../../hooks/usePromise.js"),require("../../../api/delivery.js"),require("../../../shared/device.js"),require("../../../utils/appEnterVerif.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),!Array){(e.resolveComponent("mot-button")+e.resolveComponent("mot-modal"))()}Math||((()=>"../../../uni_modules/mot-button/components/mot-button/mot-button.js")+(()=>"../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js"))();const l=e.defineComponent({__name:"index",setup(l){const m=n.useUserStore(),k=t.useDeviceStore(),j=e.reactive({freeLocker:k.freeLocker,cabinet:k.cabinet}),p=e.ref(""),h=e.computed((()=>"jd_device_type"===p.value?m.jdOrderOpt.locker_type:m.orderOpt.locker_type));e.onLoad((async e=>{if("deposit"===(null==e?void 0:e.from))return void(p.value="deposit");p.value=(null==e?void 0:e.from)||"";const r="jd_device_type"===p.value?o.lockerSenceMap.express:"";j.freeLocker=await k.assignLocker(k.cabinet.id,h.value,void 0,void 0,r)})),e.onShow((e=>{console.log("locker onShow",e),c.unite.setNavigationBarTitle(i.t("order.locker.title"))}));const q=e.computed((()=>k.lockers.filter((e=>e.type===h.value)).sort(((e,r)=>e.name>r.name?1:-1)))),f=()=>{"deposit"===p.value?a.navigateBack().then((()=>{_()})):"jd_device_type"===p.value?(v(),a.navigateBack({delta:2}).then((()=>{var r;e.index.$emit(s.EMIT_GET_LOCKER_RULE,{locker_type:h.value,rental_period:null==(r=m.jdOrderOpt)?void 0:r.rental_period})}))):a.navigateTo("/pages/v1/deposit/index").then((()=>{_()}))},v=()=>{var e;const{freeLocker:r}=j;k.setFreeLocker(r);const o=(null==(e=m.jdOrderOpt)?void 0:e.data)||{},s=u.deepClone(o),{province:i,city:t,region:n,address:d="",id:a}=k.site;console.log(k.site);const{address:c}=k.cabinet,l=`${d}${c?""+(d?"-":"")+c:""}`;s.sender_contact=Object.assign({},s.sender_contact,{province:i,city:t,area:n,address:l}),console.log(r.id),m.setJdOrderOpt({locker_id:r.id,locker_name:r.name,site_id:a,data:s})},_=()=>{const{freeLocker:r}=j;k.setFreeLocker(r),e.index.$emit(s.EMIT_UPDATE_FREE_LOCKER,{freeLocker:r})},g=e=>e.status!==r.StatusEnum.Normal||e.door_status!==r.StatusEnum.Normal,L=e.ref();return(r,o)=>({a:e.t(e.unref(i.t)("order.locker.desc")),b:e.t(e.unref(d.fullLockerName)(e.unref(j).freeLocker.name,e.unref(j).cabinet.address)),c:e.f(e.unref(q),((r,o,s)=>{var i;return{a:e.t(e.unref(d.fullLockerName)(r.name,null==(i=e.unref(j).cabinet)?void 0:i.address)),b:"l"+r.id,c:r.id,d:r.id===e.unref(j).freeLocker.id?1:"",e:g(r)?1:"",f:e.o((e=>{var o;g(o=r)||j.freeLocker.id===o.id||(j.freeLocker=o)}),r.id)}})),d:e.t(e.unref(i.t)("order.locker.btn")),e:e.o(f),f:e.p({shape:"square",isBlock:!0,disabled:!e.unref(j).freeLocker.id}),g:e.sr(L,"583e24b2-1",{k:"ModalRef"}),h:e.p({id:"ModalRef"})})}}),m=e._export_sfc(l,[["__scopeId","data-v-583e24b2"]]);wx.createPage(m);
