"use strict";const e=require("../../../common/vendor.js"),o=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../store/modules/app.js");const n=require("../../../store/modules/device.js");require("../../../store/modules/order.js");const r=require("../../../store/modules/user.js"),t=require("../../../const/order.js"),i=require("../../../const/emit.js");require("../../../utils/uniAsync.js");const s=require("../../../utils/validate.js");require("../../../utils/wx.log.js");const u=require("../../../utils/config/index.js"),a=require("../../../hooks/uni-hooks/dialog.js");require("../../../hooks/uni-hooks/request.js");const d=require("../../../hooks/uni-hooks/router.js"),c=require("../../../hooks/uni-hooks/unite.js");require("../../../hooks/uni-hooks/wechat.js");const l=require("../../../api/user.js"),m=require("../../../hooks/useCountryCode.js"),p=require("../../../hooks/use-keyval/index.js");if(require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../utils/config/env.js"),require("../../../const/platform.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../theme/hooks/useTheme.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),require("../../../api/device.js"),require("../../../api/order.js"),require("../../../hooks/usePromise.js"),require("../../../api/delivery.js"),require("../../../shared/device.js"),require("../../../const/common.js"),require("../../../utils/appEnterVerif.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),require("../../../const/coupon.js"),!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("mot-button")+e.resolveComponent("mot-cascader")+e.resolveComponent("mot-modal"))()}Math||((()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni_modules/mot-button/components/mot-button/mot-button.js")+(()=>"../../../uni_modules/mot-cascader/components/mot-cascader/mot-cascader.js")+(()=>"../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js"))();const f=e.defineComponent({__name:"index",setup(f){const{DocumentTypeListMap:g,DocumentTypeMap:h}=p.useKeyval(),{countryList:v,setCountryList:j}=m.useCountryCode(),y=e.ref([]),q=e.ref(!1),k=e.ref(!1),x=e=>{"documentType"===e?q.value=!0:k.value=!0};r.useUserStore();const _=n.useDeviceStore(),T=e.reactive({name:"",id_card:"",faceBaseUrl:"",documentType:t.DocumentTypeEnum.IDCard,country:"CN"}),C=e.ref([]),D=()=>{C.value=v.value.map((e=>({text:`${e.name}-${e.enName}`,value:e.code,code:e.code,reg:(null==e?void 0:e.documentTypeReg)?new RegExp(e.documentTypeReg):null}))),y.value=g.value.filter((e=>{var o;return!(e.value===t.DocumentTypeEnum.Passport&&!(null==(o=v.value)?void 0:o.length))})),console.log(y.value)},E=e.computed((()=>{const e=C.value.findIndex((e=>e.value===T.country));return e>-1&&C.value[e].text})),b=e.ref(t.DepositTypeEnum.PickCode);e.onLoad((e=>{(async()=>{v.value.length?D():j().then((()=>{D()})).catch((()=>{D()}))})();const n=Number(null==e?void 0:e.fetch_type);if(n===t.DepositTypeEnum.IdCard){const{id_card:e,real_name:n}=_.IdInfo;if(T.name=n,T.id_card=e,!e||!n)return void a.dialog.showModal({content:o.t("sub-pages.order.deposit.index.51"),showCancel:!1}).then(d.goHome)}if(n===t.DepositTypeEnum.FacePad){if(!_.faceBase64Url)return void a.dialog.showModal({content:o.t("sub-pages.order.deposit.index.46"),showCancel:!1}).then(d.goHome);T.faceBaseUrl="data:image/jpeg;base64,"+_.faceBase64Url}b.value=n,c.unite.setNavigationBarTitle(o.t("single.get-id.index.1"))}));const I=async()=>{if(!T.name)return void a.toast(o.t("single.get-id.index.9"));if(T.documentType===t.DocumentTypeEnum.Passport?s.isRegCode(T.id_card,T.country,C.value):s.isRegCode(T.id_card,T.documentType,y.value))if(T.documentType===t.DocumentTypeEnum.IDCard){const{name:n,id_card:r}=T;if(b.value===t.DepositTypeEnum.FacePad){return void(await l.userApi.postIdentity({name:n,id_card:r,image_base64:T.faceBaseUrl},!1)?d.navigateBack({delta:1}).then((()=>{e.index.$emit(i.EMIT_ID_CARD_SUCCESS,!0)})):a.dialog.showModal({content:o.t("sub-pages.order.deposit.index.46"),showCancel:!1}).then(d.goHome))}d.navigateTo(`/sub-pages/v1/face/index?name=${T.name}&id_card=${T.id_card}&from=identify`)}else d.navigateBack({delta:1}).then((()=>{e.index.$emit(i.EMIT_ID_CARD_SUCCESS,!0)}));else a.toast(o.t("single.get-id.index.10"))},w=e.ref();return(n,r)=>({a:e.unref(u.config).fileBaseUrl+"/home/get-id-bg.png",b:e.t(e.unref(o.t)("single.get-id.index.1")),c:e.t(e.unref(o.t)("single.get-id.index.3")),d:e.t(e.unref(o.t)("single.get-id.index.4")),e:e.unref(T).name?1:"",f:e.unref(o.t)("single.get-id.index.5"),g:e.unref(T).name,h:e.o((o=>e.unref(T).name=o.detail.value)),i:e.t(e.unref(o.t)("single.get-id.index.13")),j:e.t(e.unref(h)[e.unref(T).documentType]),k:e.o((e=>x("documentType"))),l:e.p({type:"right",size:"16",color:"#222222"}),m:e.t(e.unref(o.t)("single.get-id.index.19")),n:e.t(e.unref(E)),o:e.o((e=>x("country"))),p:e.p({type:"right",size:"16",color:"#222222"}),q:e.unref(T).documentType===e.unref(t.DocumentTypeEnum).Passport,r:e.t(e.unref(o.t)("single.get-id.index.6")),s:e.unref(T).documentType===e.unref(t.DocumentTypeEnum).IDCard?"idcard":"",t:e.unref(T).id_card?1:"",v:e.unref(o.t)("single.get-id.index.7"),w:e.unref(T).id_card,x:e.o((o=>e.unref(T).id_card=o.detail.value)),y:e.t(e.unref(o.t)("single.get-id.index.8")),z:e.p({shape:"square",isBlock:!0}),A:e.o(I),B:e.o((o=>e.unref(T).documentType=o)),C:e.o((o=>e.isRef(q)?q.value=o:null)),D:e.p({title:e.unref(o.t)("single.get-id.index.17"),"render-data":e.unref(y),modelValue:e.unref(T).documentType,visible:e.unref(q)}),E:e.o((o=>e.unref(T).country=o)),F:e.o((o=>e.isRef(k)?k.value=o:null)),G:e.p({title:e.unref(o.t)("single.get-id.index.18"),"render-data":e.unref(C),modelValue:e.unref(T).country,visible:e.unref(k)}),H:e.sr(w,"a9432486-5",{k:"ModalRef"}),I:e.p({id:"ModalRef"})})}}),g=e._export_sfc(f,[["__scopeId","data-v-a9432486"]]);wx.createPage(g);
