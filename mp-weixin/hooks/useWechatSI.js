"use strict";var e=Object.defineProperty,t=(t,o,i)=>(((t,o,i)=>{o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i})(t,"symbol"!=typeof o?o+"":o,i),i);const o=require("../common/vendor.js");require("../local/index.js"),require("./uni-hooks/new-dialog.js"),require("../store/modules/app.js"),require("../store/modules/device.js"),require("../store/modules/order.js"),require("../store/modules/user.js"),require("./uni-hooks/dialog.js"),require("./uni-hooks/request.js"),require("./uni-hooks/wechat.js"),require("./useCountryCode.js"),require("../utils/uniAsync.js"),require("../utils/wx.log.js");const i=require("../utils/config/index.js");const n=new class{constructor(){t(this,"innerAudioContext"),t(this,"textToSpeech",((e,t="zh_CN")=>new Promise(((o,i)=>{requirePlugin("WechatSI").textToSpeech({lang:t,content:e,success:e=>o(e.filename),fail:i})})))),t(this,"playAudio",(e=>(this.createAudioContext(e),this.setupAudioContextHandlers())))}async autoPlay(e,t=0,o=1){if(this.stopAudio(),!i.config.isMpWeixin||t>=o)return;const n=await this.textToSpeech(e),s=await this.playAudio(n);"stop"!==(null==s?void 0:s.type)&&await this.autoPlay(e,t+1,o)}stopAudio(){var e,t,o,i;this.innerAudioContext&&(null==(t=(e=this.innerAudioContext).stop)||t.call(e),null==(i=(o=this.innerAudioContext).destroy)||i.call(o))}createAudioContext(e){this.innerAudioContext=o.wx$1.createInnerAudioContext(),this.innerAudioContext.src=e,this.innerAudioContext.play()}setupAudioContextHandlers(){return new Promise(((e,t)=>{this.innerAudioContext.onStop((()=>e({type:"stop"}))),this.innerAudioContext.onEnded((()=>{this.innerAudioContext.destroy(),e({type:"end"})})),this.innerAudioContext.onError((e=>{this.innerAudioContext.destroy(),t(e)}))}))}};exports.useWechatSI=function(){const e=o.ref(n);return o.onUnmounted((()=>{e.value.stopAudio()})),{pluginService:e,autoPlay:(t,o=0,i=1)=>e.value.autoPlay(t,o,i),stopAudio:()=>e.value.stopAudio()}};
