"use strict";const e=require("../../../common/vendor.js"),n=require("../../../utils/common.js"),o=require("../../../utils/format.js"),r=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../store/modules/app.js");const s=require("../../../store/modules/device.js");require("../../../store/modules/order.js");const t=require("../../../store/modules/user.js");require("../../../hooks/uni-hooks/dialog.js"),require("../../../hooks/uni-hooks/request.js");const u=require("../../../const/order.js");require("../../../hooks/uni-hooks/wechat.js");const i=require("../../../api/order.js");require("../../../hooks/useCountryCode.js");const a=require("../../../hooks/use-mix.js"),c=require("../../../utils/order.js");require("../../../utils/uniAsync.js"),require("../../../utils/wx.log.js");const d=require("../../../utils/config/index.js"),m=require("../../../theme/hooks/useTheme.js");if(require("../../../hooks/uni-hooks/unite.js"),require("../../../const/platform.js"),require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../utils/config/env.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../api/device.js"),require("../../../api/user.js"),require("../../../hooks/uni-hooks/router.js"),require("../../../hooks/usePromise.js"),require("../../../api/delivery.js"),require("../../../shared/device.js"),require("../../../const/common.js"),require("../../../utils/appEnterVerif.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),require("../../../utils/precision.js"),require("../../../const/coupon.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("mot-modal")+e.resolveComponent("mot-cascader"))()}Math||((()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js")+(()=>"../../../uni_modules/mot-cascader/components/mot-cascader/mot-cascader.js"))();const p=e.defineComponent({options:{styleIsolation:"shared"},__name:"index",props:{modelValue:{type:Boolean,default:!1},order:{type:Object,default:()=>{}},from:{type:String,default:""}},emits:["update:modelValue","confirm"],setup(p,{emit:l}){const f=p,{themeConfig:h}=m.useTheme(),j=h.value["$success-color"],{isMpWeixin:T}=d.config,x=t.useUserStore();s.useDeviceStore();const q=e.reactive({user:{balance:0},canUseTime:0,usedTime:0,overTime:0,totalMoney:0,extendTimeList:[],isOpened:!1,extensionMinutes:0});e.watch((()=>f.modelValue),(async n=>{await e.nextTick$1(),n&&g()}),{immediate:!0}),e.watch((()=>f.order),(async e=>{var n,r;const s=e.owing_at||e.end_at;let t=0;t=e.rent_type===u.OrderRentTypeEnum.Count?Math.ceil((+new Date(s)-+new Date(e.start_at))/6e4)||0:Math.floor((+new Date(s)-+new Date(e.start_at))/6e4)||0,q.usedTime=e.used_time||0,q.canUseTime=t-q.usedTime,q.overTime=Math.ceil((+new Date-+new Date(s))/6e4)||0;const c=await i.lockerOrderApi.rechargeOptions(e.id);q.extendTimeList=c.filter((e=>e.extension_minutes>q.overTime)).map((e=>({label:`${o.numberToZhTime(e.extension_minutes)} (${a.useToYuan(e.money)})`,money:e.money,value:e.extension_minutes}))),q.extensionMinutes=(null==(n=q.extendTimeList[0])?void 0:n.value)||0,q.totalMoney=null==(r=q.extendTimeList[0])?void 0:r.money})),e.watch((()=>q.extensionMinutes),(e=>{var n;q.totalMoney=(null==(n=q.extendTimeList.find((n=>n.value===e)))?void 0:n.money)||0}));const y=()=>{if(console.log("-----调用fetchData------"),"jd"!==f.from&&"jd_again"!==f.from)g();else{const{fetchSite:e}=f.order;e&&e()}},g=async()=>{q.user=await x.fetchUser()},b=e.computed({get:()=>f.modelValue,set:e=>l("update:modelValue",e)}),v=()=>{q.isOpened=!0},w=()=>{f.order.optType===u.OrderButtonEnum.Renew?l("confirm",{...f.order,extension_minutes:q.extensionMinutes,money:q.totalMoney,fetchUser:y}):l("confirm",{...f.order,fetchUser:y})},k=(e,n=1)=>{const{balance:o}=q.user,{use_balance_enable:r}=e.info||{};if(console.log("[ showBalanceMoney ] >",o,r),r&&o>0){const r=1===n?c.showRechargeMoney(e):q.totalMoney;return o-r>=0?r:o}return 0},M=e=>{const{balance:n}=q.user,{use_balance_enable:o}=e.info||{},r=c.showRechargeMoney(e);if(o&&n>0){const e=n-r;return e>=0?0:Math.abs(e)}return r};return(s,t)=>{var i,d;return e.e({a:e.t(e.unref(r.t)("components.business.recharge-popup.index.1")),b:p.order.optType===e.unref(u.OrderButtonEnum).RenewEnd||p.order.optType===e.unref(u.OrderButtonOptionEnum).RenewEnd||p.order.optType===e.unref(u.OrderButtonOptionEnum).RenewOpen},p.order.optType===e.unref(u.OrderButtonEnum).RenewEnd||p.order.optType===e.unref(u.OrderButtonOptionEnum).RenewEnd||p.order.optType===e.unref(u.OrderButtonOptionEnum).RenewOpen?{c:e.t(e.unref(r.t)("components.business.recharge-popup.index.2")+":"),d:e.t(e.unref(a.useToYuan)(e.unref(c.showRechargeMoney)(p.order))),e:e.t(e.unref(r.t)("components.business.recharge-popup.index.4")),f:e.t(e.unref(a.useToYuan)(k(p.order))),g:e.t(e.unref(T)?e.unref(r.t)("components.business.recharge-popup.index.6"):e.unref(r.t)("components.business.recharge-popup.index.7")),h:e.t(e.unref(a.useToYuan)(M(p.order)))}:{},{i:p.order.optType===e.unref(u.OrderButtonEnum).Renew},p.order.optType===e.unref(u.OrderButtonEnum).Renew?e.e({j:e.t(e.unref(r.t)("components.business.recharge-popup.index.3")),k:e.t(e.unref(o.numberToZhTime)(e.unref(q).canUseTime)),l:e.t(e.unref(r.t)("components.business.recharge-popup.index.5")),m:e.t(e.unref(o.numberToZhTime)(e.unref(q).usedTime)),n:e.t(e.unref(r.t)("components.business.recharge-popup.index.9")),o:e.t(e.unref(o.numberToZhTime)(e.unref(q).overTime)),p:e.unref(q).overTime>0&&e.unref(c.showRechargeMoney)(p.order)},e.unref(q).overTime>0&&e.unref(c.showRechargeMoney)(p.order)?{q:e.t(e.unref(r.t)("sub-pages.order.pick.components.order-item.1")),r:e.t(e.unref(a.useToYuan)(e.unref(c.showRechargeMoney)(p.order)))}:{},{s:e.t(e.unref(r.t)("components.business.recharge-popup.index.10")),t:e.t((null==(i=e.unref(q))?void 0:i.extendTimeList.length)&&(null==(d=e.unref(q))?void 0:d.extensionMinutes)?e.unref(n.handleTableFilterArr)(e.unref(q).extensionMinutes,e.unref(q).extendTimeList).label:e.unref(r.t)("sub-pages.common.device-type.index.5")),v:e.p({type:"right",size:"10",color:e.unref(j)}),w:e.o(v),x:e.t(e.unref(r.t)("components.business.recharge-popup.index.11")),y:e.t(e.unref(a.useToYuan)(e.unref(q).totalMoney)),z:e.t(e.unref(r.t)("components.business.recharge-popup.index.4")),A:e.t(e.unref(a.useToYuan)(k(p.order,2))),B:e.t(e.unref(T)?e.unref(r.t)("components.business.recharge-popup.index.6"):e.unref(r.t)("components.business.recharge-popup.index.7")),C:e.t(e.unref(a.useToYuan)(e.unref(q).totalMoney-k(p.order,2)))}):{},{D:e.o(w),E:e.o((n=>e.isRef(b)?b.value=n:null)),F:e.p({title:"",buttonShape:"square",confirmText:e.unref(r.t)("components.business.recharge-popup.index.8"),cancelText:e.unref(r.t)("button.cancel"),modelValue:e.unref(b)}),G:e.o((n=>e.unref(q).extensionMinutes=n)),H:e.o((n=>e.unref(q).isOpened=n)),I:e.p({title:e.unref(r.t)("sub-pages.common.device-type.index.5"),fieldNames:{text:"label",value:"value",children:"children"},"render-data":e.unref(q).extendTimeList,modelValue:e.unref(q).extensionMinutes,visible:e.unref(q).isOpened})})}}}),l=e._export_sfc(p,[["__scopeId","data-v-a2a973c5"]]);wx.createComponent(l);
