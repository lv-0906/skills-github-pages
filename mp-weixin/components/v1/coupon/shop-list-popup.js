"use strict";const e=require("../../../common/vendor.js"),o=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../store/modules/app.js"),require("../../../store/modules/device.js"),require("../../../store/modules/order.js"),require("../../../store/modules/user.js"),require("../../../hooks/uni-hooks/dialog.js"),require("../../../hooks/uni-hooks/request.js"),require("../../../hooks/uni-hooks/wechat.js");const s=require("../../../hooks/usePagination.js"),i=require("../../../api/shop.js");require("../../../hooks/useCountryCode.js"),require("../../../utils/uniAsync.js"),require("../../../utils/wx.log.js");const r=require("../../../utils/config/index.js");if(require("../../../hooks/uni-hooks/unite.js"),require("../../../const/platform.js"),require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../utils/config/env.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../theme/hooks/useTheme.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),require("../../../api/device.js"),require("../../../api/order.js"),require("../../../api/user.js"),require("../../../const/order.js"),require("../../../hooks/uni-hooks/router.js"),require("../../../hooks/usePromise.js"),require("../../../api/delivery.js"),require("../../../shared/device.js"),require("../../../const/common.js"),require("../../../utils/appEnterVerif.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),!Array){(e.resolveComponent("mot-button")+e.resolveComponent("mot-empty")+e.resolveComponent("uni-popup"))()}Math||(n+u+(()=>"../../../uni_modules/mot-button/components/mot-button/mot-button.js")+(()=>"../../../uni_modules/mot-empty/components/mot-empty/mot-empty.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const n=()=>"../../popup-header/index.js",u=()=>"../../mot-search/index.js",t=e.defineComponent({__name:"shop-list-popup",props:{visible:{type:Boolean,default:!1}},emits:["comfirm","fetch","update:visible"],setup(n,{emit:u}){const t=n,{query:a,useSkip:p}=s.usePagination(),l=e.reactive({name:""}),m=e.ref(),c=e.reactive({shopList:[]});e.onBeforeMount((async()=>{d()})),e.onMounted((()=>{}));const d=async(e=!1)=>{if(a.lastPage||a.loading)return;a.loading=!0;const o={limit:20,skip:p()};o.name=l.name;const s=await i.shopApi.get(o).finally((()=>{a.loading=!1}));s.length===a.limit?a.page+=1:a.lastPage=!0,c.shopList=e?s:c.shopList.concat(s)};e.watch((()=>t.visible),(async o=>{await e.nextTick$1(),o?m.value&&m.value.open():m.value&&m.value.close()}),{immediate:!0});const h=()=>{a.page=1,a.lastPage=!1,c.shopList=[],d(!0)},j=()=>{u("update:visible",!1)};return(s,i)=>e.e({a:e.o(j),b:e.p({title:e.unref(o.t)("coupon.select_store")}),c:e.o(h),d:e.o((o=>e.unref(l).name=o)),e:e.p({placeholder:e.unref(o.t)("coupon.search_merchant_name"),modelValue:e.unref(l).name}),f:e.unref(c).shopList.length},e.unref(c).shopList.length?e.e({g:e.f(e.unref(c).shopList,((o,s,i)=>({a:e.t(o.name),b:e.t((null==o?void 0:o.province)+(null==o?void 0:o.city)+(null==o?void 0:o.region)+(null==o?void 0:o.address)||"-"+(null==o?void 0:o.address)),c:e.o((e=>(e=>{u("comfirm",e),j()})(o)),null==o?void 0:o.id),d:"a046c3b4-3-"+i+",a046c3b4-0",e:null==o?void 0:o.id}))),h:e.p({type:"primary",size:"mini",text:e.unref(o.t)("common.select")}),i:e.unref(a).lastPage},e.unref(a).lastPage?{j:e.t(e.unref(o.t)("sub-pages.me.coupon.index.5"))}:{},{k:e.o((e=>d()))}):{l:e.p({description:e.unref(o.t)("common.no_data"),image:e.unref(r.config).fileBaseUrl+"/order_empty.png"})},{m:e.sr(m,"a046c3b4-0",{k:"popup"}),n:e.p({type:"bottom","safe-area":!1,"is-mask-click":!1})})}}),a=e._export_sfc(t,[["__scopeId","data-v-a046c3b4"]]);wx.createComponent(a);
