"use strict";const e=require("../../../common/vendor.js"),o=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../store/modules/app.js");const u=require("../../../store/modules/device.js");require("../../../store/modules/order.js");const s=require("../../../store/modules/user.js"),r=require("../../../const/site.js"),i=require("../../../const/coupon.js");require("../../../utils/uniAsync.js"),require("../../../utils/wx.log.js"),require("../../../utils/config/index.js");const t=require("../../../hooks/uni-hooks/dialog.js");if(require("../../../hooks/uni-hooks/request.js"),require("../../../hooks/uni-hooks/wechat.js"),require("../../../hooks/useCountryCode.js"),require("../../../hooks/uni-hooks/unite.js"),require("../../../const/platform.js"),require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../utils/config/env.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../theme/hooks/useTheme.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),require("../../../api/device.js"),require("../../../api/order.js"),require("../../../api/user.js"),require("../../../const/order.js"),require("../../../hooks/uni-hooks/router.js"),require("../../../hooks/usePromise.js"),require("../../../api/delivery.js"),require("../../../shared/device.js"),require("../../../const/common.js"),require("../../../utils/appEnterVerif.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),!Array){(e.resolveComponent("mot-button")+e.resolveComponent("uni-popup"))()}Math||(p+n+(()=>"../../../uni_modules/mot-button/components/mot-button/mot-button.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const n=()=>"./coupon-list-item.js",p=()=>"../../popup-header/index.js",c=e.defineComponent({options:{virtualHost:!0},__name:"coupon-popup",props:{visible:{type:Boolean,default:!1},modelValue:{type:Object,default:()=>{}},coupons:{type:Array,default:()=>[]}},emits:["update:modelValue","fetch","update:visible"],setup(n,{emit:p}){const c=n,a=u.useDeviceStore(),l=s.useUserStore(),d=e.ref(),m=e.reactive({coupon:{},coupons:[]}),j=e.computed((()=>l.orderOpt.locker_type));e.watch((()=>c.visible),(async o=>{await e.nextTick$1(),o?(m.coupons=c.coupons,m.coupon=c.modelValue,d.value&&d.value.open()):d.value&&d.value.close()}),{immediate:!0});const h=()=>{p("update:visible",!1)},q=(e,o)=>e===r.payRuleTypeEnum.Count&&o===i.CouponTypeEnum.TIME,k=e=>!(e===j.value||!e),v=()=>{p("update:modelValue",{...m.coupon}),p("fetch"),h()};return(u,s)=>({a:e.o(h),b:e.p({title:e.unref(o.t)("components.business.coupon-popup.index.1")}),c:e.f(e.unref(m).coupons,((u,s,r)=>{var i;return{a:"cd89bcad-2-"+r+",cd89bcad-0",b:e.p({coupon:u,active:(null==(i=e.unref(m).coupon)?void 0:i.id)===(null==u?void 0:u.id),type:"popup"}),c:null==u?void 0:u.id,d:e.o((e=>(e=>{var u;if(e.disabled)t.toast(o.t("v1.coupon.coupon-popup.1"));else if(e.id!==(null==(u=m.coupon)?void 0:u.id)){const{payRule:{type:u}}=a;if(q(u,e.type)||k(e.locker_type))return t.toast(o.t("v1.coupon.coupon-popup.1")),!1;m.coupon=e}else m.coupon={}})(u)),null==u?void 0:u.id)}})),d:e.t(e.unref(o.t)("order.locker.btn")),e:e.o(v),f:e.p({shape:"square",isBlock:!0}),g:e.sr(d,"cd89bcad-0",{k:"popup"}),h:e.p({type:"bottom","safe-area":!1,"is-mask-click":!1})})}}),a=e._export_sfc(c,[["__scopeId","data-v-cd89bcad"]]);wx.createComponent(a);
