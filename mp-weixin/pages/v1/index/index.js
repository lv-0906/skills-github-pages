"use strict";const e=require("../../../common/vendor.js"),r=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../store/modules/app.js");const o=require("../../../store/modules/device.js");require("../../../store/modules/order.js");const s=require("../../../store/modules/user.js"),n=require("../../../const/order.js");require("../../../utils/uniAsync.js"),require("../../../utils/wx.log.js"),require("../../../utils/config/index.js");const i=require("../../../hooks/uni-hooks/dialog.js"),u=require("../../../hooks/uni-hooks/emitKey.js");require("../../../hooks/uni-hooks/request.js");const t=require("../../../hooks/uni-hooks/router.js"),a=require("../../../hooks/uni-hooks/unite.js"),d=require("../../../hooks/uni-hooks/wechat.js");require("../../../hooks/useCountryCode.js");const c=require("../../../api/order.js"),l=require("../../../hooks/business/use-order-btn-opt.js"),h=require("../../../theme/hooks/useTheme.js"),p=require("./hook.js");if(require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../utils/config/env.js"),require("../../../const/platform.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../api/device.js"),require("../../../api/user.js"),require("../../../hooks/usePromise.js"),require("../../../api/delivery.js"),require("../../../shared/device.js"),require("../../../const/common.js"),require("../../../utils/appEnterVerif.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),require("../../../hooks/useWechatSI.js"),require("../../../shared/order.js"),require("../../../shared/pay.js"),require("../../../utils/is.js"),require("../../../hooks/use-keyval/index.js"),require("../../../const/coupon.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("mot-modal"))()}Math||((()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+g+f+q+j+m+k+(()=>"../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js"))();const m=()=>"../../../components/business/change-language-popup/index.js",j=()=>"../../../components/business/recharge-popup/index.js",g=()=>"./components/order-item.js",f=()=>"./components/order-empty.js",q=()=>"../../../components/business/slide-popup/index.js",k=()=>"../../../components/special-model/order-open-model/index.js",v=e.defineComponent({__name:"index",setup(m){const j=o.useDeviceStore(),g=s.useUserStore(),{themeConfig:f}=h.useTheme(),q=f.value["$primary-color-link"],{showLanguagePopup:k,onShowLanguagePopup:v,onChangeLanguage:_,languageText:b}=p.useLang(),x=e.reactive({orders:[]}),w=e.ref();e.onLoad((async e=>{const{id:r,page:o,sceneInfo:s}=g;"scan"===(null==e?void 0:e.from)&&r&&"home"===o&&(await j.fetchCabinet({id:r,locker_scene:null==s?void 0:s.locker_scene}),d.envEvent.report.addGlobal({locker_scene:r})),d.envEvent.report.addPage({page_name:"a_page_home_view",full_cabinet_entrance_type:"scan"===(null==e?void 0:e.from)?"scan":"click"}),E()})),e.onShow((o=>{a.unite.setNavigationBarTitle(r.t("v1_index.title")),e.index.$once(u.EMIT_REFRESH_HOME,(()=>{E()}))})),e.onPullDownRefresh((()=>{E(!0)}));const y=e.computed((()=>{const e=g.language;return r.langImgPath[e].bannerImg})),E=async(e=!1)=>{x.orders=await c.lockerOrderApi.find({limit:2,status:n.OrderStatusEnum.Progressing}).finally((()=>{R(e)}))},R=o=>{o&&(e.index.stopPullDownRefresh(),i.toast(r.t("pages.person.index.7")))},C=async()=>{var e;const{id:r,page:o}=g;r&&"home"===o&&(null==(e=j.cabinet)?void 0:e.id)?O():d.envEvent.scanCode().then((async e=>{await j.fetchCabinet(e),O()})).catch((e=>{console.log(e,"err")}))},O=async()=>{d.envEvent.report.addClick("a_page_home_clk"),j.goNextPage()},{useBtnOperateState:P,cbOrderItem:S,cbRenew:I}=l.useBtnOperate(E),T=async({type:e})=>{if(e===n.OrderButtonEnum.Close)return await c.lockerOrderApi.end(P.order.id),void t.navigateTo(`/pages/order/result/index?orderId=${P.order.id}&from=${n.OrderResultEnum.DONE}`).then((()=>{E()}));t.navigateTo(`/pages/order/unlock/index?orderId=${P.order.id}&from=${n.OrderResultEnum.DONE}`)},$=e.ref();return(o,s)=>e.e({a:"overflow:"+(e.unref(P).showRecharge?"hidden":"visible"),b:e.unref(y),c:e.t(e.unref(r.t)("v1_index.rent_button")),d:e.o(C),e:e.t(e.unref(r.t)("v1_index.order_title")),f:e.unref(x).orders.length>0},e.unref(x).orders.length>0?{g:e.t(e.unref(r.t)("v1_index.order_sub_title")),h:e.p({type:"right",size:"16",color:e.unref(q)})}:{},{i:e.unref(x).orders.length>0},e.unref(x).orders.length>0?{j:e.f(e.unref(x).orders,((r,o,s)=>({a:r.id,b:e.o(e.unref(S),r.id),c:"63a09b59-1-"+s,d:e.p({order:r})})))}:{},{k:e.o(T),l:e.o((r=>e.unref(P).showSlid=r)),m:e.p({type:e.unref(P).slidType,modelValue:e.unref(P).showSlid}),n:e.o(e.unref(I)),o:e.o((r=>e.unref(P).showRecharge=r)),p:e.p({order:e.unref(P).order,modelValue:e.unref(P).showRecharge}),q:e.o(e.unref(_)),r:e.o((r=>e.isRef(k)?k.value=r:null)),s:e.p({visible:e.unref(k)}),t:e.sr(w,"63a09b59-6",{k:"openRef"}),v:e.sr($,"63a09b59-7",{k:"ModalRef"}),w:e.p({id:"ModalRef"})})}}),_=e._export_sfc(v,[["__scopeId","data-v-63a09b59"]]);wx.createPage(_);
