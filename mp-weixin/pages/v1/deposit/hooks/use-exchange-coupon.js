"use strict";require("../../../../store/modules/app.js");const e=require("../../../../store/modules/device.js");require("../../../../store/modules/order.js");const o=require("../../../../store/modules/user.js"),u=require("../../../../const/coupon.js"),n=require("../../../../local/index.js"),s=require("../../../../hooks/uni-hooks/new-dialog.js"),r=require("../../../../common/vendor.js");require("../../../../utils/uniAsync.js"),require("../../../../utils/wx.log.js"),require("../../../../utils/config/index.js"),require("../../../../hooks/uni-hooks/dialog.js"),require("../../../../hooks/uni-hooks/request.js"),require("../../../../hooks/uni-hooks/wechat.js"),require("../../../../hooks/useCountryCode.js");const c=require("../../../../api/coupon.js"),i=require("../../../../hooks/business/use-exchange-coupon.js"),{code:t}=i.useExchangeCouponGlobal();exports.useExchangeConpon=()=>{const i=o.useUserStore(),p=e.useDeviceStore(),a=r.ref(!1),l=r.ref(!1),h=r.ref(""),d=r.ref(null),v=r.computed((()=>{var e,o;return(null==(o=m(null==(e=i.vipCoupon)?void 0:e.coupon_packages))?void 0:o.length)>0||p.shop.mt_coupon_enable||p.shop.no_problem_coupon_enabled})),m=e=>{const{locker_type:o}=i.orderOpt;return null==e?void 0:e.filter((e=>e.locker_type===o||!e.locker_type))},q=r.ref(!1);r.onReady((async()=>{const e=setTimeout((async()=>{await g(),clearTimeout(e)}),500)}));const g=async()=>{if(!p.shop.mt_coupon_enable||!i.phone)return!1;if(q.value)return!1;const e=await c.couponExchangeApi.check({phone:i.phone,shop_id:p.shop.id});return!!e.length&&(q.value=!0,s.confirm(n.t("coupon.meituan_exchange_prompt")).then((()=>{t.value=e[0].receipt_code,a.value=!0,h.value=u.CouponActiveTabEnum.EXCHANGE})),!0)};return{showExchageCoupon:v,showExchangePopup:a,openExchangePopup:()=>{a.value=!0},activeTab:h,openSuccessPopup:()=>{l.value=!0},showSuccessPopup:l,onComfirmExchange:({coupon:e,type:o})=>{"exchange"===o&&(l.value=!0,d.value=e)},currentCoupon:d,hasOpend:q,checkHasCoupon:g}};
