"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../local/index.js"),u=require("../../../../hooks/uni-hooks/new-dialog.js");require("../../../../store/modules/app.js");const s=require("../../../../store/modules/device.js");require("../../../../store/modules/order.js");const r=require("../../../../store/modules/user.js"),i=require("../../../../const/site.js"),n=require("../../../../const/coupon.js");require("../../../../utils/uniAsync.js"),require("../../../../utils/wx.log.js"),require("../../../../utils/config/index.js"),require("../../../../hooks/uni-hooks/dialog.js"),require("../../../../hooks/uni-hooks/request.js"),require("../../../../hooks/uni-hooks/wechat.js"),require("../../../../hooks/useCountryCode.js");const t=require("../../../../api/coupon.js"),p=s.useDeviceStore(),c=r.useUserStore(),l=e.computed((()=>c.orderOpt.locker_type));exports.useConpon=()=>{const s=e.ref(!1),r=e.ref(!0),c=e.ref({}),d=e.ref([]);return{showCoupon:r,currentCoupon:c,showCouponPopup:s,openCouponPopup:()=>{s.value=!0},setCouponList:async e=>{const s=await t.couponApi.find({limit:100,site_id:p.siteId,status:n.CouponStatusEnum.AVAILABLE,channel_in:"1,2,3,4,5,6,7"}),r=p.payRule,a=s.filter((e=>{const o=(s=r.type,t=e.type,s===i.payRuleTypeEnum.Count&&t===n.CouponTypeEnum.TIME||!((u=e.locker_type)===l.value||!u));var u,s,t;return e.disabled=o,!o}));d.value=s;const q=a.some((o=>o.id===(null==e?void 0:e.id)));if(!e||!q)return e&&!q?(c.value={},void u.alert(o.t("v1.coupon.coupon-popup.1"))):void(c.value=a[0]);c.value=e},couponList:d}};
