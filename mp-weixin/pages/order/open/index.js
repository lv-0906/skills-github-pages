"use strict";const e=require("../../../common/vendor.js"),r=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../store/modules/app.js");const o=require("../../../store/modules/device.js");require("../../../store/modules/order.js");const s=require("../../../store/modules/user.js"),i=require("../../../const/order.js"),n=require("../../../const/platform.js");require("../../../utils/uniAsync.js"),require("../../../utils/wx.log.js"),require("../../../utils/config/index.js");const u=require("../../../hooks/uni-hooks/dialog.js");require("../../../hooks/uni-hooks/request.js");const t=require("../../../hooks/uni-hooks/router.js"),d=require("../../../hooks/uni-hooks/unite.js"),a=require("../../../hooks/uni-hooks/wechat.js"),c=require("../../../hooks/usePromise.js"),m=require("../../../hooks/useWechatSI.js");require("../../../hooks/useCountryCode.js");const l=require("../../../api/order.js"),p=require("../../../api/delivery.js");require("../../../shared/order.js");const h=require("../../../shared/pay.js");if(require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../utils/config/env.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../theme/hooks/useTheme.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),require("../../../api/device.js"),require("../../../api/user.js"),require("../../../shared/device.js"),require("../../../const/common.js"),require("../../../utils/appEnterVerif.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),require("../../../hooks/use-keyval/index.js"),require("../../../const/coupon.js"),require("../../../utils/is.js"),!Array){e.resolveComponent("mot-modal")()}Math||(j+(()=>"../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js"))();const j=()=>"../../../components/business/running-ball/index.js",q=e.defineComponent({__name:"index",setup(j){const{autoPlay:q}=m.useWechatSI(),{cabinet:g,freeLocker:f}=o.useDeviceStore(),{orderOpt:E,jdOrderOpt:k}=s.useUserStore(),v=e.reactive({from:i.OrderResultEnum.CREATE,displayId:"",payway:n.PlatformEnumPayEnum.wx}),x={[i.OrderResultEnum.CREATE]:{title:r.t("pages.opening_locker"),desc:r.t("components.business.running-ball.index.1"),desc2:r.t("order.open.tip")},[i.OrderResultEnum.JDCREATE]:{title:r.t("pages.opening_locker"),desc:r.t("components.business.running-ball.index.1"),desc2:r.t("order.open.tip")},[i.OrderResultEnum.RESERVE]:{title:r.t("order.locking.in_progress"),desc:r.t("order.locking"),desc2:r.t("order.locking.please_wait")}};e.onLoad((e=>{const{displayId:o,from:s=i.OrderResultEnum.CREATE,payed:u,payway:t}=e||{};if(v.from=s,v.displayId=o,v.payway=t||n.PlatformEnumPayEnum.wx,q(r.t("sub-pages.order.open.index.1")),o)return a.envEvent.report.addPage({page_name:"a_page_open_view"}),void y(o);d.unite.setNavigationBarTitle(x[s].title),R()}));const y=async e=>{try{const{promise:r}=h.transactionPreOrderResult(e),o=await r,{order:s}=o,{err_code:i,id:n}=s||{};if(1705===i||1601===i){const e=`${v.from}&orderId=${n}&code=${i}`;return void t.reLaunch(`/sub-pages/order/exception/mqtt/index?from=${e}`)}a.envEvent.report.addPage({page_name:"a_page_result_view"}),_(s.id)}catch(o){const{msg:e=r.t("sub-pages.order.open.index.5"),code:s=400}=o||{};return void u.dialog.alert(`${e}(${s})`).then((()=>{v.from!==i.OrderResultEnum.JDCREATE?t.goHome():t.reLaunch("/sub-pages/v2/xd/home/index")}))}},R=async()=>{let e={};e=v.from===i.OrderResultEnum.JDCREATE?{...k}:{...E},console.log(e),console.log("[ createFreeOrder err ] >",e);const[o,s]=v.from===i.OrderResultEnum.JDCREATE?await c.usePromise(p.DeliveryApi.postLogistic(e,!1)):await c.usePromise(l.lockerOrderApi.post(e,!1));if(o){const{ErrCode:e=5001,ErrMsg:s=r.t("store.modules.device.3")}=o||{};return void u.dialog.alert(`${s}(${e})`).then((()=>{v.from===i.OrderResultEnum.JDCREATE?t.reLaunch("/sub-pages/v2/xd/home/index"):t.goHome()}))}const{err_code:n,id:d}=s||{};if(1705!==n&&1601!==n)_(d);else{const e=`${v.from}&orderId=${d}&code=${n}`;t.reLaunch(`/sub-pages/order/exception/mqtt/index?from=${e}`)}},_=e=>{v.from!==i.OrderResultEnum.JDCREATE?t.reLaunch(`/pages/order/result/index?orderId=${e}&from=${v.from}`):t.reLaunch(`/sub-pages/v2/xd/result/index?orderId=${e}&from=${v.from}`)},b=e.ref();return(r,o)=>({a:e.p({address:e.unref(g).address,name:e.unref(f).name,desc:x[e.unref(v).from].desc}),b:e.t(x[e.unref(v).from].desc2),c:e.sr(b,"bf530e6d-1",{k:"ModalRef"}),d:e.p({id:"ModalRef"})})}}),g=e._export_sfc(q,[["__scopeId","data-v-bf530e6d"]]);wx.createPage(g);
