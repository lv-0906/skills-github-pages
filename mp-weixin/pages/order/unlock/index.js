"use strict";const e=require("../../../common/vendor.js"),r=require("../../../local/index.js");require("../../../hooks/uni-hooks/new-dialog.js"),require("../../../store/modules/app.js");const o=require("../../../store/modules/device.js");require("../../../store/modules/order.js"),require("../../../store/modules/user.js");const s=require("../../../const/order.js");require("../../../utils/uniAsync.js"),require("../../../utils/wx.log.js"),require("../../../utils/config/index.js");const i=require("../../../hooks/uni-hooks/dialog.js");require("../../../hooks/uni-hooks/request.js");const u=require("../../../hooks/uni-hooks/router.js"),n=require("../../../hooks/uni-hooks/unite.js");require("../../../hooks/uni-hooks/wechat.js");const t=require("../../../hooks/useWechatSI.js");require("../../../hooks/useCountryCode.js");const d=require("../../../api/order.js"),c=require("../../../api/delivery.js");require("../../../shared/order.js");const a=require("../../../shared/pay.js"),m=require("../../../theme/hooks/useTheme.js");if(require("../../../shared/cache.js"),require("../../../const/cache.js"),require("../../../hooks/uni-hooks/cache.js"),require("../../../utils/config/env.js"),require("../../../const/platform.js"),require("../../../uni_modules/mot-utils/index.js"),require("../../../api/device.js"),require("../../../api/user.js"),require("../../../hooks/usePromise.js"),require("../../../shared/device.js"),require("../../../const/common.js"),require("../../../utils/appEnterVerif.js"),require("../../../hooks/use-common.js"),require("../../../hooks/uni-hooks/loading.js"),require("../../../hooks/uni-hooks/common.js"),require("../../../utils/url.js"),require("../../../hooks/uni-hooks/report.js"),require("../../../api/data.js"),require("../../../hooks/use-keyval/index.js"),require("../../../const/coupon.js"),require("../../../utils/is.js"),require("../../../theme/hooks/themeConfig.js"),require("../../../theme/hooks/themeKeys.js"),!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("mot-modal"))()}Math||(l+(()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni_modules/mot-modal/components/mot-modal/mot-modal.js"))();const l=()=>"../../../components/business/running-ball/index.js",f=e.defineComponent({__name:"index",setup(l){const{autoPlay:f}=t.useWechatSI(),{themeConfig:h}=m.useTheme(),j=o.useDeviceStore(),p=h.value["$danger-color"],q=e.reactive({order:{},from:s.OrderResultEnum.UNLOCK,displayId:"",traceId:""});e.onLoad((e=>{const{orderId:o,from:i=s.OrderResultEnum.UNLOCK,displayId:u,traceId:t}=e||{};q.from=i,q.displayId=u,q.traceId=t,k(o,u),n.unite.setNavigationBarTitle(r.t("pages.opening_locker"))}));const k=async(e,o)=>{const i=q.from===s.OrderResultEnum.JDCANCEL?c.DeliveryApi.getLogisticOrderDetail:d.lockerOrderApi.get;q.order=await i(e,!1),o?(f(r.t("sub-pages.order.unlock.index.9")),g(o)):x(e)},g=async e=>{try{const{promise:r}=a.transactionPreOrderResult(e),o=await r,{order:i}=o,{err_code:n,id:t}=i||{};if(1705===n||1601===n){const e=`${q.from}&orderId=${t}&code=${n}&traceId=${q.traceId}`;return void u.reLaunch(`/sub-pages/order/exception/mqtt/index?from=${e}`)}if(![s.OrderResultEnum.FORGET,s.OrderResultEnum.JDCANCEL].includes(q.from))return void x(i.id);q.from===s.OrderResultEnum.JDCANCEL?u.redirectTo(`/sub-pages/v2/xd/result/index?orderId=${t}&from=${q.from}`):u.redirectTo(`/pages/order/result/index?orderId=${t}&from=${q.from}`)}catch(o){const{msg:e=r.t("sub-pages.order.open.index.5"),code:n=400}=o||{};return void i.dialog.alert(`${e}(${n})`).then((()=>{q.from!==s.OrderResultEnum.JDCANCEL?u.goHome():u.redirectTo("/sub-pages/v2/xd/home/index")}))}},x=async e=>{const r={};q.from===s.OrderResultEnum.DONE&&(r.end=!0);const o=q.from===s.OrderResultEnum.FORGET;o&&(r.forget=!0),q.from===s.OrderResultEnum.JDCANCEL&&(r.cancel=!0,r.trace_id=q.traceId),await j.open(e,r,{ignore1705:o},q.from),q.from!==s.OrderResultEnum.JDCANCEL?u.redirectTo(`/pages/order/result/index?orderId=${e}&from=${q.from}`):u.redirectTo(`/sub-pages/v2/xd/result/index?orderId=${e}&from=${q.from}`)},{order:v}=e.toRefs(q),C=e.ref();return(o,s)=>({a:e.p({address:e.unref(v).info&&e.unref(v).info.cabinet_address,name:e.unref(v).info&&e.unref(v).info.locker_name}),b:e.t(e.unref(r.t)("sub-pages.order.unlock.index.1")),c:e.t(e.unref(r.t)("sub-pages.order.unlock.index.3")),d:e.p({type:"info-filled",size:"30",color:e.unref(p)}),e:e.t(e.unref(r.t)("sub-pages.order.unlock.index.5")),f:e.sr(C,"cc4c811f-2",{k:"ModalRef"}),g:e.p({id:"ModalRef"})})}}),h=e._export_sfc(f,[["__scopeId","data-v-cc4c811f"]]);wx.createPage(h);
