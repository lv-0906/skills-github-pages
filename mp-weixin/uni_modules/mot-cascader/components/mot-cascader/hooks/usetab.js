"use strict";const e=require("../../../../../common/vendor.js");exports.useTab=(l,a)=>{const t=e.ref(-1),u=e.computed((()=>l.fieldNames.value)),o=e.computed((()=>l.fieldNames.text)),s=e.computed((()=>l.fieldNames.children)),v=e.ref([]),n=e.ref([]),i=e.ref(-1),r=e.ref({options:[],selected:null}),c=e.ref(!1),d=(e,l)=>{const a=(e,l)=>{for(const t of e){if(t[u.value]===l)return[t];if(t[s.value]){const e=a(t[s.value],l);if(e)return[t,...e]}}},t=a(e,l);if(t){let l=e;n.value=t.map((e=>{const a={options:l,selected:e},t=l.find((l=>l[u.value]===e[u.value]));return t&&(l=t[s.value]),a})),l&&n.value.push({options:l,selected:{[o.value]:"请选择"}})}else n.value=[{options:e,selected:{[o.value]:"请选择"}}];v.value=n.value.map((e=>e.selected))||[],p(n.value.length-1)},p=e=>{const l=Math.max(t.value,e);i.value=Math.max(i.value,l),t.value=e,r.value=(e=>{const l=n.value[e]||{options:[],selected:null};l.options&&l.options.sort(((e,l)=>{var a,t;const u=null==(a=e.spell)?void 0:a.charAt(0).toUpperCase(),o=null==(t=l.spell)?void 0:t.charAt(0).toUpperCase();return u<o?-1:u>o?1:0}));const a={};return l.options.forEach(((e,l)=>{var t;const u=null==(t=e.spell)?void 0:t.charAt(0).toUpperCase();a[u]||(a[u]=!0,e.firstChar=u)})),l})(e)},f=e=>{var a,o,s;c.value=!0;let{selected:n=[]}=r.value;n=(null==(a=null==n?void 0:n.some)?void 0:a.call(n,(l=>m(l,e))))?null==(o=null==n?void 0:n.filter)?void 0:o.call(n,(l=>!m(l,e))):Array.isArray(n)?[...n,e]:null===n?[e]:[n,e];const i=null==(s=null==n?void 0:n.filter)?void 0:s.call(n,(e=>e[u.value]));v.value[t.value]={text:l.options.formatmultipleSelected(null==i?void 0:i.length)},r.value.selected=n},m=(e,l)=>e[u.value]===l[u.value];return{updateTabs:d,activeTab:t,tabList:v,selectedTabOptions:r,onSelectOption:e=>{if(a("change",e),c.value=!1,l.multiple){if(l.isAsync&&!e[s.value]||!l.isAsync&&t.value===i.value)return void f(e);t.value===i.value-1&&(e[s.value]=e[s.value]||[])}d(l.renderData,e[u.value]),l.multiple||e[s.value]||(a("update:modelValue",e[u.value]),a("confirm",v.value),a("update:visible",!1))},isLastDeep:i,showMultiple:c,onChangeTab:p}};
